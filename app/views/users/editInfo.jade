.loading_div(ng-show='loading')
div.user_edit_info.dl_card_tebcontent(ng-show='!loading')
  form.form-horizontal(name="accountForm" enctype="application/json" method="post" action="/users/saveAccount/#{this_user._id}")
    .dl_row
      h5.pull-left #{__("INFO")}
      if role === 'OWNER'
        button.dl_btn.dl_btn_small.pull-right(type="button" ng-if="!editing" ng-click="toggleEdit()") 编辑
        button.dl_btn.dl_btn_small.cancel_btn.pull-right(type="button" ng-if="editing" ng-click="toggleEdit()") 取消
        button.dl_btn.dl_btn_small.pull-right(type="submit" ng-disabled="accountForm.$invalid&&editing" ng-if="editing") 保存
    hr.margin_top_6
    if role === 'OWNER'
      .dl_row.clearfix
        .aside
          img.img-responsive.size_128.img-thumbnail(ng-src="{{user.photo ? user.photo :'/img/icons/default_user_photo.png'}}")
        .dl_row.margin_top_15
          a.clearLinkUnderline.dl_btn.dl_btn_medium(href="/users/editPhoto/#{this_user._id}") #{__("CHANGE")}#{__("AVATAR")}
        .dl_row.margin_top_15
          a(href="#/changePassword/#{this_user._id}")
            button.dl_btn.dl_btn_medium #{__("CHANGE")}#{__("PASSWORD")}
    .dl_row.clearfix(ng-if="user.nickname || editing")
      .info_side
        span.info_label #{__("NICKNAME")}
      .info_detail_2(ng-if="!editing")
        span.info_label #{this_user.nickname}
      .info_detail(ng-if="editing")
        input.dl_input.dl-form-control.editToggle(type="text" name="user[nickname]" ng-model="user.nickname" ng-maxlength=20 tooltip="{{accountForm.nickname.$invalid? '昵称最长字数20字':''}}" tooltip-placement="right" required ng-cloak)
    .dl_row.clearfix(ng-if="user.realname || editing")
      .info_side
        span.info_label #{__("REALNAME")}
      .info_detail_2(ng-if="!editing")
        span.info_label #{this_user.realname}
      .info_detail(ng-if="editing")
        input.dl_input.dl-form-control.editToggle(type="text" name ="user[realname]" ng-model="user.realname" ng-maxlength=20 tooltip="{{accountForm.realname.$invalid? '真实姓名最长20字':''}}" tooltip-placement="right" ng-cloak)
    .dl_row.clearfix
      .info_side
        span.info_label #{__("COMPANY")}
      .info_side
        span.info_label #{this_user.cname}
    .dl_row.clearfix(ng-if="user.introduce || editing")
      .info_side
        span.info_label #{__("BRIEF")}
      .info_detail_2(ng-if='!editing')
        span.info_label #{this_user.introduce}
      .info_detail(ng-if="editing")
        textarea.dl_input.dl-form-control.editToggle(rows="2" cols="40" name="user[introduce]" ng-model="user.introduce" ng-maxlength="40" tooltip="{{accountForm.introduce.$invalid? '个人简介最长40字':''}}" tooltip-placement="right" ng-cloak maxlength="40")
    .dl_row.clearfix(ng-if="user.sex || editing")
      .info_side
        span.info_label #{__("GENDER")}
      .info_detail_2(ng-if="!editing")
        span.info_label #{this_user.sex}
      .info_detail(ng-if="role!='PARTNER' && editing")
        span.radio.info_radio.info_label
          input(type="radio" name="user[sex]" value="男" ng-model="user.sex")
          | #{__("MALE")}
        span.radio.info_radio.info_label
          input(type="radio" name="user[sex]" value="女" ng-model="user.sex")
          | #{__("FEMALE")}

    .dl_row.clearfix(ng-if="user.department != '' || editing")
      .info_side
        span.info_label 部门
      .info_detail(ng-if="editing")
        .tree.select_tree
          ul
            li(ng-include="'node.html'" ng-class="hasChild(node)")
      .info_detail_2(ng-if="!editing")
        span.info_label #{this_user.department.name}

    .dl_row.clearfix
      .info_side
        span.info_label #{__("REGISTER_DATE")}
      .info_side
        span.info_label #{moment(this_user.register_date).format('YYYY-MM-DD HH:mm:ss')}
    .dl_row.clearfix
      .info_side
        span.info_label 参加的小队
      .info_detail_2
        .team(ng-repeat="team in user.team " ng-if="team.gid!=0")
          a(href="/group/page/{{team._id}}")
            img.size_48(ng-src="{{team.logo}}/48/48" title="{{team.name}}")
          //span.info_label {{team.name}}
    .dl_row
      h5.pull-left #{__("CONTACT")}
    hr.margin_top_6
    .dl_row.clearfix(ng-if="user.phone || editing")
      .info_side
        span.info_label #{__("PHONE")}
      .info_detail_2(ng-if="!editing")
        span.info_label #{this_user.phone}
      .info_detail(ng-if="editing")
        input.dl_input.dl-form-control.editToggle(type="text" name="user[phone]" ng-model="user.phone" ng-maxlength=20)
    .dl_row.clearfix(ng-if="user.email || editing")
      .info_side
        span.info_label #{__("EMAIL")}
      .info_detail_2
        span.info_label #{this_user.email}
      //- .info_detail(ng-if="editing")
      //-   input.dl_input.dl-form-control.editToggle(type="email" name="user[email]" ng-model="user.email")
    .dl_row.clearfix(ng-if="user.qq || editing")
      .info_side
        span.info_label #{__("QQ")}
      .info_detail_2(ng-if="!editing")
        span.info_label #{this_user.qq}
      .info_detail(ng-if="editing")
        input.dl_input.dl-form-control.editToggle(type="text" name="user[qq]" ng-model="user.qq" ng-maxlength=20)
    input(type="hidden" name="did" value="{{last_selected_node._id}}")

  script.
    $(function() {
      $('#birthday').datetimepicker({
        autoclose: true,
        endDate: new Date(),
        minView: 2,
        format: 'yyyy-mm-dd'
      });
    });

  script(type="text/ng-template" id="node.html")
    .self.inline
      span(ng-click="selectNode(node)" ng-class="{'selected': node.selected}")
        .inline &nbsp;{{node.name}}
    ul(ng-if="!node.hideChild")
      li(ng-repeat="node in node.department" ng-include="'node.html'" ng-class="hasChild(node)")
