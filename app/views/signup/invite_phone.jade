extends ../layouts/base

block content
  .header
    img.logo(src="/img/dl_logol.png")
  .registerpage_phone
    .signup_title
      span 个人注册
    div(ng-controller='ActiveController' ng-init="currentDomain='#{domains[0]}';")
      if invitedUser
        .hidden#invitedUserData(data-id="#{invitedUser.id}" data-email="#{invitedUser.email}"  data-realname="#{invitedUser.realname}" data-nickname="#{invitedUser.nickname}" data-active="#{invitedUser.mail_active}")
      form(role="form" name='active_form' action='/users/dealActive' method='post')
        .form-group.dl_sm_group(ng-class="{'has-error':active&&active!==1}")
          .dl_row
            label.control-label(for="email") ＊企业邮箱
          if invitedUser
            .dl_row.email_row
              input.dl-form-control(type="text" value="{{email}}" disabled)
            input(type="hidden" name="email" value="#{invitedUser.email}")
            input(type="hidden" name="inviteKey" value="#{inviteKey}")
          else
            .dl_row.email_row
              input.email_row_email(type="text" name="host" ng-model="email" placeholder="email" ng-blur="mailCheck()" required)
              span.email_row_split @
              if domains.length === 1
                input(type="hidden" name="domain" ng-model="currentDomain" value="#{domains[0]}")
                input.email_row_email(type="text" value="#{domains[0]}" disabled="true")
              if domains.length > 1
                select.email_row_email.dl_select(name="domain" ng-model="currentDomain" ng-change="mailCheck()")
                  each domain in domains
                    option(value="#{domain}" selected='selected')= domain
              input(type="text" name="index" ng-model="active" ng-show='false')
            if inviteQR
              input(type="hidden" name="inviteKey" value="#{inviteKey}")
              input(type="hidden" name="uid" value="#{uid}")
              input(type="hidden" name="inviteKind" value="QR")
          div(ng-show="(active||loading)&&active!==4" ng-cloak)
            p
            img(ng-show='loading' src='/img/loading.gif')
            div(ng-show='active==1' ng-cloak)
              span 此邮箱未被注册!
            div(ng-show='active==2' ng-cloak)
              p 您的邮箱已注册过,请查收邮件,若未收到请点击重发按钮再次发送。
              p 
                span 若之前不是本人操作请
                a.subtitle(ng-click="active=4") 再次填写信息
                span 并查看邮箱激活。
            div(ng-show='active==3' ng-cloak)
              span 您的邮箱已注册,请
              a(href='/users/signin') 登录。
              span 若是您忘记了密码,
              a(href='/users/forgetPwd') 请点此跳转
            p
          div(ng-if="!active || active==1 || active ==4")
            //-未注册过、未激活需重填资料时显示
            .dl_row(ng-class="{'has-error':active_form.nickname.$invalid && active_form.nickname.$dirty}")
              label.control-label(for="nickname") ＊#{__("NICKNAME")}
              input.dl-form-control(type="text" name="nickname" ng-model="nickname" tooltip-placement="top" tooltip="{{active_form.nickname.$invalid && active_form.nickname.$dirty ? '请填写昵称':''}}" required)
            .dl_row(ng-class="{'has-error':active_form.password.$invalid && active_form.password.$dirty}")
              label.control-label(for="password") ＊密码
              input.dl-form-control(type="password" name="password" ng-model="$parent.password" ng-minlength=6 tooltip-placement="top" tooltip="{{active_form.password.$invalid && active_form.password.$dirty ? '请输入密码':''}}" required)
            .dl_row(ng-class="{'has-error':active_form.passconf.$invalid && active_form.passconf.$dirty}")
              label.control-label(for="passconf") ＊密码确认
              input.dl-form-control(type="password" name="passconf" ng-model="$parent.passconf" ng-minlength=6 tooltip-placement="top" match="$parent.password" tooltip="{{active_form.passconf.$invalid && active_form.passconf.$dirty ? '请输入确认密码':''}}" required)
            .dl_row(ng-class="{'has-error':active_form.realname.$invalid && active_form.realName.$dirty}")
              label.control-label(for="realname") ＊#{__("REALNAME")}
              input.dl-form-control(type="text" placeholder="仅公司成员可见" name="realname" ng-model="realname" tooltip-placement="top" tooltip="{{active_form.realName.$invalid && active_form.realName.$dirty ? '请输入真实姓名':''}}" required)
            .dl_row.clearfix
              label.control-label(for="department") ＊#{__("DEPARTMENT")}
              .select_right
                .select_box(ng-if="department_exist")
                  select.dl_select(data-placeholder="选择主部门" tabindex="2" ng-model="main_department" ng-options="d.name for d in main_departments" ng-change="selectMainDepartment(main_department)" ng-disabled="main_departments.length == 0")
                  input(type="text" name="main_department_id" ng-model="main_department_id" ng-show="false")
                  input(type="text" name="main_department_name" ng-model="main_department_name" ng-show="false")
                .select_box(ng-if="department_exist")
                  select.dl_select(data-placeholder="选择二级部门" tabindex="2" ng-model="child_department" ng-options="d.name for d in child_departments" ng-change="selectChildDepartment(child_department)" ng-disabled="child_departments.length == 0")
                  input(type="text" name="child_department_id" ng-model="child_department_id" ng-show="false")
                  input(type="text" name="child_department_name" ng-model="child_department_name" ng-show="false")
                .select_box(ng-if="department_exist" last_child)
                  select.dl_select(data-placeholder="选择三级部门" tabindex="2" ng-model="grandchild_department" ng-options="d.name for d in grandchild_departments" ng-change="selectGrandChildDepartment(grandchild_department)" ng-disabled="grandchild_departments.length == 0")
                  input(type="text" name="grandchild_department_id" ng-model="grandchild_department_id" ng-show="false")
                  input(type="text" name="grandchild_department_name" ng-model="grandchild_department_name" ng-show="false")
                span.dl_vertical(ng-if="!department_exist") 贵公司还未创建部门,请等待部门创建后再选择!
            .dl_row.clearfix
              label.control-label(for="phone") #{__("PHONE")}
              input.dl-form-control(type="text" name="phone" ng-model="phone")
            .dl_row
              span 点击注册即同意<a target="_blank" href="/about#law">服务条款</a>
            .dl_row(ng-show="active!==3 && active!==2")
              button.dl_btn.btn_submit(type="submit" ng-disabled="(active!==1 && active!==4 && !isInvited) || active_form.$invalid") 免费注册个人账号
            .dl_row(ng-show="active==2")
              button.dl_btn.btn_submit(type="submit") 重发激活邮件
  footer.phone_footer
    span  Copyright &copy; Donler 2014. All Rights Reserved  
block footExt
  script(src="/js/controllers/user.js")
  script.
    window.location.hash='';
    var $buoop = {vs:{i:10,f:15,o:12.1,s:5.1}}; 
    $buoop.ol = window.onload; 
    window.onload=function(){ 
      try {if ($buoop.ol) {$buoop.ol();} }catch (e) {} 
      var e = document.createElement("script"); 
      e.setAttribute("type", "text/javascript"); 
      e.setAttribute("src", "/js/notice/update.js"); 
      document.body.appendChild(e);
    } 