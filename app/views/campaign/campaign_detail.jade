extends ../layouts/user_base

append headExt
  link(rel="stylesheet" href="/css/photo_album.css")
  link(rel="stylesheet" href="/css/campaign_detail.css")

block contentExt
  .dl_detail_container.clearfix(ng-controller="campaignController" ng-init="campaign=#{JSON.stringify(campaign)};user = #{JSON.stringify(user)};join=#{join}")
    include ../partials/breadcrumb
    +breadcrumb(links)
    .dl_detail_main
      //-TODO:详情页权限不正确，需要更改
      if (role==='HR' || Global.role==='LEADER') && active
        span.pull-right
          btn.cancel_btn.dl_btn_small.operator_btn(ng-click="cancel(campaign._id)") 关闭活动
      ul.nav.nav-tabs
        li.tab_style(ng-class="{'active':nowTab=='campaign'}")
          a.subtitle.no_radius.border_red {{campaign.theme}}

      .dl_detail_border.clearfix
        .dl_detail_content
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("PLACE")}#{__("LOCATION")}:
            .dl_detail_detail
              span {{campaign.location.name}}
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("START_TIME")}:
            .dl_detail_detail
              span {{campaign.start_time | date:'yyyy-MM-dd HH:mm'}} {{campaign.start_time | week }}
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("END_TIME")}:
            .dl_detail_detail
              span {{campaign.end_time | date:'yyyy-MM-dd HH:mm'}} {{campaign.end_time | week }}
          .dl_detail_row
            .dl_detail_label
              span #{__("LEAST")}#{__("ENTRY")}#{__("SUM")}:
            .dl_detail_detail
              span {{campaign.member_min}}
          .dl_detail_row
            .dl_detail_label
              span #{__("ENTRY")}#{__("SUM")}#{__("LIMIT")}:
            .dl_detail_detail
              span {{campaign.member_max}}
          .dl_detail_row
            .dl_detail_label
              span #{__("ENTRY")}#{__("DEADLINE")}:
            .dl_detail_detail
              span {{campaign.deadline| date:'yyyy-MM-dd HH:mm'}} {{campaign.deadline | week }}
        .dl_detail_aside
            img.img_contain.size_128(ng-src="#{campaignLogo}")
        .dl_detail_content2
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("SIMPLE")}#{__("INTRODUCTION")}:
            .dl_detail_detail
              span.dl_word_break {{campaign.content}}
           if active && (role==='MEMBER' ||role ==='LEADER') && !over
            div.margin_top_30
              input.dl_btn.dl_btn_detail(type = "button" value = "{{'QUIT'|translate}}{{'CAMPAIGN'|translate}}" ng-click="quitCampaign()" ng-if="join==1")
              input.dl_btn.dl_btn_detail(type = "button" value = "{{'ENTRY'|translate}}{{'JOIN'|translate}}" ng-click="joinCampaign()" ng-if="join!==1" ng-disabled="join==0")
      if !active
        .dl_detail_row.text-center
          span 活动已经停止
      //-成员
      .dl_detail_member(bs-popover)
        p.subtitle #{__("JOIN")}#{__("MEMBER")}:
        div.member(ng-repeat = "_member in campaign.member")
          a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
            img.img_contain.detail_photo(ng-src="{{_member.photo}}")
            span.name {{shortTrim(_member.nickname)}}
        span.info_label(ng-if="!campaign.member.length") 该活动还没有人参加哦!
      .dl_detail_member(ng-if="campaign.member_quit.length>0" bs-popover)
        p.subtitle 退出#{__("MEMBER")}:
        div.member(ng-repeat = "_member in campaign.member_quit")
          a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
            img.img_contain.detail_photo(ng-src="{{_member.photo}}")
            span.name {{shortTrim(_member.nickname)}}
      form.dl_detail_main(name="comment_form" novalidate)
        p.subtitle #{__("I")}#{__("WANT")}#{__("LEAVEMESSAGE")}
        textarea.dl_modal_input.form-control(rows="3" name="content" ng-model="new_comment.text" ng-change="judge()" placeholder="请控制在140字以内" maxlength=140 required)
        button.dl_btn.pull-right.dl_btn_submit(ng-click="comment()" ng-disabled="comment_form.$invalid") #{__("SUBMIT")}#{__("LEAVEMESSAGE")}
        .dl_row(bs-popover)
          section
            br
            div.comment.clearfix(ng-repeat="comment in comments")
              .comment_user_info
                a(href="/users/home/{{comment.poster._id}}" )
                  img.user_photo.size_56(ng-src="{{comment.poster.photo}}" ng-Mouseenter="showUserCard(comment.poster._id,comment._id)" id='pop{{comment._id}}' rel='popover')
                p
                  a.user_name(href="/users/home/{{comment.poster._id}}") {{shortTrim(comment.poster.nickname)}}
              .comment_content_panel
                .relative
                  .triangle_border
                  .triangle
                  .comment_content
                    p {{comment.content}}
                label.comment_date.text {{comment.create_date | date:'yyyy-MM-dd HH:mm'}}
                a.mouse_hidden.comment_date.text.pull-right(ng-if="comment.delete_permission" ng-click="deleteComment($index)") 删除
    .dl_detail_side
      p.subtitle.locationtitle #{__("CAMPAIGN")}#{__("LOCATION")}
        #mapContainer.size_400
      if role!=='PARTNER'
        p.subtitle.clearfix #{__("CAMPAIGN")}#{__("WONDERFUL")}#{__("PHOTO")}
          a.dl_btn.dl_btn_upload.pull-right(href="/photoAlbumDetailView/#{campaign.photo_album._id}") 上传活动照片
        .photo_album
          each photo in photo_thumbnails
            a.thumbnail_cell(href="/photoView/#{campaign.photo_album._id}/#{photo._id}")
              img.thumbnail_img.img-thumbnail(src="#{photo.thumbnail_uri}")
              p.thumbnail_name.text-center= photo.name

append footExt
  script(src="/js/controllers/campaign.js")
append bottomExt
  script(src="http://api.map.baidu.com/api?v=2.0&ak=krPnXlL3wNORRa1KYN1RAx3c")

