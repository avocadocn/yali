extends ../layouts/user_base

append headExt
  link(rel="stylesheet" href="/css/campaign_detail.css")
block contentExt
  .campaign_detail.dl_container(ng-controller="campaignController")
    .breadcrumb
    .campaign_panel
      .main_panel
        .component.detail_card
          .component_head
            span.title #{campaign.theme}
            span.sub_title #{campaign.campaign_unit[0].team.name}
            button.head_button(ng-if="!isJoin" ng-click="join('#{campaign.campaign_unit[0].company._id}', '#{campaign.campaign_unit[0].team._id}')") 参加
            button.head_button(ng-if="isJoin" ng-click="quit()") 退出
          .component_body
            .base_info
              .logo_container
                each unit in campaign.campaign_unit
                  img.logo(src="#{unit.team.logo}")
              .info_container
                .start_info
                  .campaign_info
                    p 开始时间: #{moment(campaign.start_time).format('YYYY-MM-DD HH:mm dddd')}
                    p 结束时间: #{moment(campaign.end_time).format('YYYY-MM-DD HH:mm dddd')}
                    p 活动地点: #{campaign.location.name}
                    p 活动类型: #{campaign.campaign_mold}
                  .time_info
                    p 距活动开始还有
                    p(count-down="#{campaign.start_time}")
                p: span.title 最新公告
                if notice
                  p #{notice.content}
                  p #{moment(notice.post_date).format('YYYY-MM-DD HH:mm')}
            hr
            p: span.title 活动简介
            div #{campaign.content}
            p: span.title 活动标签
            .tags
              each tag in campaign.tags
                span.tag #{tag}
            p: span.title 报名信息
            p 报名人数上限: #{campaign.members.length}/#{campaign.member_max}
            p 报名人数下限: #{campaign.member_min}
            p 报名截止日期: #{moment(campaign.deadline).format('YYYY-MM-DD HH:mm dddd')}

      .panel_divider

      .side_panel

        .component
          .component_head
            span.title 活动地点
            a.head_button(href="http://mo.amap.com/?q=#{campaign.location.coordinates[1]},#{campaign.location.coordinates[0]}&name=#{campaign.location.name}" target="_blank") 大图
          .component_body
            if campaign.location.coordinates.length==2
              a(href="http://mo.amap.com/?q=#{campaign.location.coordinates[1]},#{campaign.location.coordinates[0]}&name=#{campaign.location.name}" target="_blank")
                img.img-responsive(src="http://restapi.amap.com/v3/staticmap?location=#{campaign.location.coordinates[0]},#{campaign.location.coordinates[1]}&zoom=15&size=268*210&markers=mid,,A:#{campaign.location.coordinates[0]},#{campaign.location.coordinates[1]}&labels=#{campaign.location.name.replace(/ /g, '')},2,0,12,0xffffff,0x3498db:#{campaign.location.coordinates[0]},#{campaign.location.coordinates[1]}&key=077eff0a89079f77e2893d6735c2f044")
            else
              img.img-responsive(src="/img/icons/nomap.jpg")

        .component.member_card
          .component_head
            span.title 活动成员(#{campaign.members.length})
            button.head_button 查看
          .component_body
            .member_list
              each member in membersForCard
                img.member(src="#{member.photo}")

        .component
          .component_head
            span.title 活动信息
            button.head_button 详情
          .component_body
            p 开始时间: #{moment(campaign.start_time).format('YYYY-MM-DD HH:mm dddd')}
            p 结束时间: #{moment(campaign.end_time).format('YYYY-MM-DD HH:mm dddd')}
            p 活动地点: #{campaign.location.name}
            p 活动类型: #{campaign.campaign_mold}

    #campaign_data(data-id="#{campaign._id}" data-start="#{isStart}" data-end="#{isEnd}" data-join="#{isJoin}")

append footExt
  script(src="/js/controllers/campaign.js")
  script(src="/js/directives/count_down.js")
