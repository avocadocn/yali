extends ../layouts/user_base

append headExt
  link(rel="stylesheet" href="/css/photo_album.css")
  link(rel="stylesheet" href="/css/campaign_detail.css")

block contentExt
  .dl_detail_container.clearfix(ng-controller="campaignController" ng-init="campaign_id='#{campaign._id}';location=#{JSON.stringify(campaign.location)};member=#{JSON.stringify(campaign.member)};join=#{join};role='#{role}';")
    include ../partials/breadcrumb
    +breadcrumb(links)
    .dl_detail_main
      //-TODO:详情页权限不正确，需要更改
      if (role==='HR' || role==='LEADER') && campaign.active &&!campaign.finish
        span.pull-right
          button.cancel_btn.dl_btn_small.operator_btn(ng-click="cancel(campaign_id)") 关闭活动
      ul.nav.nav-tabs
        li.tab_style(ng-class="{'active':true}")
          a.subtitle.no_radius.border_red= campaign.theme

      .dl_detail_border.clearfix
        .dl_detail_content
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("START_TIME")}:
            .dl_detail_detail
              span= moment(campaign.start_time).format("YYYY-MM-DD HH:mm dddd")
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("END_TIME")}:
            .dl_detail_detail
              span= moment(campaign.end_time).format("YYYY-MM-DD HH:mm dddd")
          .dl_detail_row
            .dl_detail_label
              span #{__("ENTRY")}#{__("DEADLINE")}:
            .dl_detail_detail
              span= moment(campaign.deadline).format("YYYY-MM-DD HH:mm dddd")
          .dl_detail_row
            .dl_detail_label
              span #{__("LEAST")}#{__("ENTRY")}#{__("SUM")}:
            .dl_detail_detail
              span= campaign.member_min
          .dl_detail_row
            .dl_detail_label
              span #{__("ENTRY")}#{__("SUM")}#{__("LIMIT")}:
            .dl_detail_detail
              span= campaign.member_max
        .dl_detail_aside
            img.img_contain.size_128(ng-src="#{campaignLogo}")
            if campaign.active && (role==='MEMBER' ||role ==='LEADER') && !campaign.finish
              .margin_top_30
                input.dl_btn.dl_btn_medium(type = "button" value = "#{__('QUIT')}#{__('CAMPAIGN')}" ng-click="quitCampaign()" ng-if="join==1")
                input.dl_btn.dl_btn_medium(type = "button" value = "#{__('ENTRY')}#{__('JOIN')}" ng-click="joinCampaign()" ng-if="join!==1" ng-disabled="join==0")
        .dl_detail_content2
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("PLACE")}#{__("LOCATION")}:
            .dl_detail_detail
              span= campaign.location.name
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("SIMPLE")}#{__("INTRODUCTION")}:
            .dl_detail_detail
              span.dl_word_break= campaign.content
      if !campaign.active
        .dl_detail_row.text-center
          span #{__("CAMPAIGNCLOSE")}
      else if campaign.finish
        .dl_detail_row.text-center
          span #{__("CAMPAIGNFINISH")}
      //-成员
      .dl_detail_member(bs-popover)
        .dl_row.subtitle
          .pull-left #{__("JOIN")}#{__("MEMBER")}:
          a.pull-right(ng-click="modalPerticipator()") 发送私信
        div.member(ng-repeat = "_member in member")
          a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
            img.img_contain.detail_photo.img_user(ng-src="{{_member.photo}}")
            span.name(ng-cloak) {{shortTrim(_member.nickname)}}
        span.info_label(ng-if="!member.length") 该活动还没有人参加哦!
      if role==='HR' || role ==='LEADER'
        .dl_detail_member(ng-init="member_quit=#{JSON.stringify(campaign.member_quit)};" ng-show="member_quit.length>0" bs-popover)
          p.subtitle 退出#{__("MEMBER")}:
          div.member(ng-repeat = "_member in member_quit")
            a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
              img.img_contain.detail_photo.img_user(ng-src="{{_member.photo}}")
              span.name(ng-cloak) {{shortTrim(_member.nickname)}}
      form.dl_detail_main(name="comment_form" novalidate)
        if role==='MEMBER' || role ==='LEADER'
          p.subtitle #{__("I")}#{__("WANT")}#{__("LEAVEMESSAGE")}
          textarea.dl_form-control(rows="3" name="content" ng-model="new_comment.text" ng-change="judge()" placeholder="请控制在140字以内" maxlength=140 required)
          button.dl_btn.pull-right.dl_btn_submit(ng-click="comment()" ng-disabled="comment_form.$invalid") #{__("SUBMIT")}#{__("LEAVEMESSAGE")}
        .dl_row(bs-popover)
          section
            br
            div.comment.clearfix(ng-repeat="comment in comments")
              .comment_user_info
                a(href="/users/home/{{comment.poster._id}}" )
                  img.user_photo.size_56.img_user(ng-src="{{comment.poster.photo}}" ng-Mouseenter="showUserCard(comment.poster._id,comment._id)" id='pop{{comment._id}}' rel='popover')
                a.dl_user_name_small(href="/users/home/{{comment.poster._id}}")(ng-cloak) {{comment.poster.nickname}}
              .comment_content_panel
                .relative
                  .triangle_border
                  .triangle
                  .comment_content
                    p(ng-cloak) {{comment.content}}
                label.comment_date.text {{comment.create_date | date:'yyyy-MM-dd HH:mm' | dateView}}
                a.mouse_hidden.comment_date.text.pull-right(ng-if="comment.delete_permission" ng-click="deleteComment($index)") 删除
    .dl_detail_side
      p.subtitle.locationtitle #{__("CAMPAIGN")}#{__("LOCATION")}
        #mapContainer.map_size
      if role!=='PARTNER'
        .clearfix
          p.subtitle.pull-left #{__("CAMPAIGN")}#{__("WONDERFUL")}#{__("PHOTO")}
          a.pull-right(href="/photoAlbumDetailView/#{campaign.photo_album._id}") 上传活动照片
        .photo_album
          each photo in photo_thumbnails
            a.thumbnail_cell(href="/photoView/#{campaign.photo_album._id}/#{photo._id}")
              img.thumbnail_img.img-thumbnail(src="#{photo.thumbnail_uri}")
              p.thumbnail_name.text-center= photo.name
    .modal.fade#sponsorMessageCampaignModel(tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true")
      include ../partials/campaign_message_send
append footExt
  script(src="/js/controllers/campaign.js")
  script.
    var script = document.createElement("script");  
    script.src = "http://api.map.baidu.com/api?v=2.0&ak=krPnXlL3wNORRa1KYN1RAx3c&callback=initialize";
    document.body.appendChild(script);