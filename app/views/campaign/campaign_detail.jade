extends ../layouts/user_base

append headExt
  link(rel="stylesheet" href="/css/photo_album.css")
  link(rel="stylesheet" href="/css/campaign_detail.css")

block contentExt
  .dl_detail_container.clearfix(ng-controller="campaignController" ng-init="campaign_id='#{campaign._id}';campaign_type='#{campaign.campaign_type}';member=#{JSON.stringify(campaign.member)};join=#{join};role='#{role}';campaign_team=#{JSON.stringify(campaign.team)};user_team=#{JSON.stringify(user.team)};")
    include ../partials/breadcrumb
    +breadcrumb(links)
    .dl_detail_main
      //-TODO:详情页权限不正确，需要更改
      if (role==='HR' || role==='LEADER') && campaign.active &&!campaign.finish
        span.pull-right
          button.cancel_btn.dl_btn_small.operator_btn(ng-click="cancel(campaign_id)") 关闭活动
      ul.nav.nav-tabs
        li.tab_style(ng-class="{'active':true}")
          a.subtitle.no_radius.border_red= campaign.theme

      .dl_detail_border.clearfix
        .dl_detail_content
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("START_TIME")}:
            .dl_detail_detail
              span= moment(campaign.start_time).format("YYYY-MM-DD HH:mm dddd")
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("END_TIME")}:
            .dl_detail_detail
              span= moment(campaign.end_time).format("YYYY-MM-DD HH:mm dddd")
          .dl_detail_row
            .dl_detail_label
              span #{__("ENTRY")}#{__("DEADLINE")}:
            .dl_detail_detail
              span= moment(campaign.deadline).format("YYYY-MM-DD HH:mm dddd")
          .dl_detail_row
            .dl_detail_label
              span #{__("LEAST")}#{__("ENTRY")}#{__("SUM")}:
            .dl_detail_detail
              span= campaign.member_min
          .dl_detail_row
            .dl_detail_label
              span #{__("ENTRY")}#{__("SUM")}#{__("LIMIT")}:
            .dl_detail_detail
              span= campaign.member_max
        .dl_detail_aside
            img.img_contain.size_128(ng-src="#{campaignLogo}")
            if campaign.active && (role==='MEMBER' ||role ==='LEADER') && !campaign.finish
              .margin_top_30
                input.dl_btn.dl_btn_medium(type = "button" value = "#{__('QUIT')}#{__('CAMPAIGN')}" ng-click="quitCampaign()" ng-if="join==1")
                input.dl_btn.dl_btn_medium(type = "button" value = "#{__('ENTRY')}#{__('JOIN')}" ng-click="joinReady()" ng-if="join!==1" ng-disabled="join==0")
        .dl_detail_content2
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("PLACE")}#{__("LOCATION")}:
            .dl_detail_detail
              span= campaign.location.name
          .dl_detail_row
            .dl_detail_label
              span #{__("CAMPAIGN")}#{__("SIMPLE")}#{__("INTRODUCTION")}:
            .dl_detail_detail
              span.dl_word_break= campaign.content
      if !campaign.active
        .dl_detail_row.text-center.margin_top_30
          span #{__("CAMPAIGNCLOSE")}
      else if campaign.finish
        .dl_detail_row.text-center.margin_top_30
          span #{__("CAMPAIGNFINISH")}
      //-成员
      .dl_detail_member(bs-popover)
        if campaign.campaign_type == 3
          .row(ng-repeat="member_team in campaign_team")
            .dl_row.subtitle
              .pull-left {{member_team.name}} #{__("JOIN")}#{__("MEMBER")}:
              a.pull-right(ng-click="modalPerticipator($index)") 发送私信
            .dl_row
              div.member(ng-repeat = "_member in member_team.join_member")
                a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
                  img.img_contain.detail_photo.img_user(ng-src="{{_member.photo}}")
                  span.name(ng-cloak) {{shortTrim(_member.nickname)}}
              span.info_label(ng-if="member_team.join_member.length == 0 || !member_team.join_member.length") 该活动还没有人参加哦!
        else
          .dl_row.subtitle
            .pull-left #{__("JOIN")}#{__("MEMBER")}:
            a.pull-right(ng-click="modalPerticipator()") 发送私信
          .dl_row
            div.member(ng-repeat = "_member in member")
              a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
                img.img_contain.detail_photo.img_user(ng-src="{{_member.photo}}")
                span.name(ng-cloak) {{shortTrim(_member.nickname)}}
            span.info_label(ng-if="!member.length") 该活动还没有人参加哦!
      if role==='HR' || role ==='LEADER'
        .dl_detail_member(ng-init="member_quit=#{JSON.stringify(campaign.member_quit)};" ng-show="member_quit.length>0" bs-popover)
          p.subtitle 退出#{__("MEMBER")}:
          div.member(ng-repeat = "_member in member_quit")
            a.item(href="/users/home/{{_member.uid}}" ng-Mouseenter="showUserCard(_member.uid,_member.uid)" id='pop{{_member.uid}}' rel='popover')
              img.img_contain.detail_photo.img_user(ng-src="{{_member.photo}}")
              span.name(ng-cloak) {{shortTrim(_member.nickname)}}
      form.commment_box(name="comment_form" novalidate)
        if role==='MEMBER' || role ==='LEADER'
          .dl_row.clearfix
            p.subtitle 我要留言
            textarea.dl-form-control(rows="2" name="content" ng-model="new_comment.text" placeholder="留言请控制在140字以内" maxlength=140 required)
            button.dl_btn.dl_btn_submit.pull-right(ng-click="comment()" ng-disabled="comment_form.$invalid") #{__("SUBMIT")}#{__("LEAVEMESSAGE")}
        .dl_row.clearfix(bs-popover)
          .comment.clearfix(ng-repeat="comment in comments")
            .comment_user_info
              a(href="/users/home/{{comment.poster._id}}" )
                img.user_photo.size_56.img_user(ng-src="{{comment.poster.photo}}" ng-Mouseenter="showUserCard(comment.poster._id,comment._id)" id='pop{{comment._id}}' rel='popover')
              a.dl_user_name_small(href="/users/home/{{comment.poster._id}}")(ng-cloak) {{comment.poster.nickname}}
            .comment_content_panel
              .relative
                .triangle_border
                .triangle
                .comment_content
                  p(ng-cloak) {{comment.content}}
              .comment_date.text {{comment.create_date | date:'yyyy-MM-dd HH:mm' | dateView}}
              a.mouse_hidden.comment_date.text.pull-right(ng-if="comment.delete_permission" ng-click="deleteComment($index)") 删除
    .dl_detail_side
      .map_container
        p.subtitle.locationtitle #{__("CAMPAIGN")}#{__("LOCATION")}
        if campaign.location.coordinates.length==2
          a(href="http://api.map.baidu.com/marker?location=#{campaign.location.coordinates[1]},#{campaign.location.coordinates[0]}&title=活动地点&content=#{campaign.location.name}&output=html" target="_blank")
            img.map_size(src="http://api.map.baidu.com/staticimage?width=268&height=210&center=#{campaign.location.coordinates[0]},#{campaign.location.coordinates[1]}&zoom=15&markers=#{campaign.location.name}|#{campaign.location.coordinates[0]},#{campaign.location.coordinates[1]}&markerStyles=m,A,0xff0000&labels=#{campaign.location.name}|#{campaign.location.coordinates[0]},#{campaign.location.coordinates[1]}&labelStyles=#{campaign.location.name},1,14,0xffffff,0x000fff,1")
        else
          img.map_size(src="/img/sign_bg.jpg")
      .photo_container
        if role!=='PARTNER'
          .clearfix
            p.subtitle.pull-left #{__("CAMPAIGN")}#{__("WONDERFUL")}#{__("PHOTO")}
            a.pull-right(href="/photoAlbumDetailView/#{campaign.photo_album._id}") 上传活动照片
          .photo_album
            each photo in photo_thumbnails
              a.thumbnail_cell(href="/photoView/#{campaign.photo_album._id}/#{photo._id}")
                img.thumbnail_img.img-thumbnail(src="#{photo.thumbnail_uri}")
                p.thumbnail_name.text-center= photo.name
    .modal.fade#sponsorMessageCampaignModel(tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true")
      include ../partials/campaign_message_send
    .modal.fade#joinTeamSelectmodal(tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true")
      include ../campaign/select_team_for_multi_campaign
append footExt
  script(src="/js/controllers/campaign.js")