"use strict";angular.module("donler.components.campaignCard",[]).controller("CampaignCardCtrl",["$scope","Campaign",function(e,t){this.join=function(e,o,n){t.join({campaignId:n.id,cid:e,tid:o},function(e){e?alertify.alert("参加失败"):(alertify.alert("参加成功"),n.isJoin=!0)})},this.quit=function(e){alertify.confirm("确定要退出该活动吗？",function(o){o&&t.quit(e.id,function(t){t?alertify.alert("退出失败"):(alertify.alert("退出成功"),e.isJoin=!1)})})}}]).directive("campaignCard",function(){return{restrict:"E",replace:!0,scope:{item:"=",role:"@",cid:"@",tid:"@"},templateUrl:"/component_templates/campaign_card.html",controller:"CampaignCardCtrl",link:function(e,t,o,n){e.join=function(t,o){n.join(t,o,e.item)},e.quit=function(){n.quit(e.item)}}}}),angular.module("donler.components",["donler.components.richComment","donler.components.scoreBoard","donler.components.imageBox","donler.components.campaignCard","donler.components.report"]),angular.module("donler.components.imageBox",[]).controller("ImageBoxCtrl",["$scope","$http",function(e,t){e.thumbBoxInnerStyle={},this.maxScrollWidth=0,this.maxShowThumbCount=0,this.thumbWidth=60;var o=this;e.canPrev=!1,e.canNext=!1,e.imagesLoaded=!1,e.setMargin=function(t){var n=0;e.images.length>o.maxShowThumbCount&&(n=t-parseInt((o.maxShowThumbCount-1)/2)),0>n&&(n=0);var r=o.thumbWidth*n;if(o.maxScrollWidth>0){r>o.maxScrollWidth&&(r=o.maxScrollWidth);var i=0-r+"px";e.thumbBoxInnerStyle={"margin-left":i}}e.canPrev=0===r?!1:!0,e.canNext=r>=o.maxScrollWidth?!1:!0},e.getMoreImages=function(o){return e.imagesLoaded?void o():void t({method:"get",url:"/photoAlbum/"+e.photoAlbumId+"/photolist"}).success(function(t){1===t.result&&(e.images=t.data,e.imagesLoaded=!0,o())}).error(function(){console.log("DATA ERROR")})}}]).directive("imageBox",function(){return{restrict:"E",replace:!0,scope:{images:"="},templateUrl:"/component_templates/image_box.html",controller:"ImageBoxCtrl",link:function(e,t,o,n){var r=e.images;if(r.length>0){e.isPreview=!1,e.prevIndex=0,e.thisIndex=0,e.nextIndex=0;var i=0,a=function(t){0>=t?(e.prevIndex=0,e.nextIndex=Math.min(t+1,r.length-1),e.thisIndex=0):t>=r.length-1?(e.prevIndex=Math.max(t-1,0),e.nextIndex=r.length-1,e.thisIndex=r.length-1):(e.prevIndex=t-1,e.nextIndex=t+1,e.thisIndex=t),i=e.thisIndex,e.previewImg=r[e.thisIndex].uri,e.setMargin(e.thisIndex)};e.choose=function(e){a(e)},e.preview=function(t){a(t),e.isPreview=!0},e.prev=function(){a(e.thisIndex-1)},e.next=function(){a(e.thisIndex+1)},e.close=function(){e.isPreview=!1},e.prevList=function(){e.canPrev&&(i-=n.maxShowThumbCount,e.setMargin(i))},e.nextList=function(){e.canNext&&(i+=n.maxShowThumbCount,e.setMargin(i))}}}}}).directive("preImageBox",["$timeout",function(e){return{restrict:"E",replace:!0,scope:{images:"=",photoAlbumId:"="},templateUrl:"/component_templates/preimage_box.html",controller:"ImageBoxCtrl",link:function(t,o,n,r){if(t.images.length>0){t.preImages=t.images,t.isPreview=!1,t.prevIndex=0,t.thisIndex=0,t.nextIndex=0;var i=0,a=function(e){0>=e?(t.prevIndex=0,t.nextIndex=Math.min(e+1,t.images.length-1),t.thisIndex=0):e>=t.images.length-1?(t.prevIndex=Math.max(e-1,0),t.nextIndex=t.images.length-1,t.thisIndex=t.images.length-1):(t.prevIndex=e-1,t.nextIndex=e+1,t.thisIndex=e),i=t.thisIndex,t.previewImg=t.images[t.thisIndex].uri,t.setMargin(t.thisIndex)};t.choose=function(e){a(e)},t.preview=function(o){t.getMoreImages(function(){for(var n=0;n<t.images.length;n++)if(t.images[n].uri==o){e(function(){a(n)});break}}),t.isPreview=!0},t.prev=function(){a(t.thisIndex-1)},t.next=function(){a(t.thisIndex+1)},t.close=function(){t.isPreview=!1},t.prevList=function(){t.canPrev&&(i-=r.maxShowThumbCount,t.setMargin(i))},t.nextList=function(){t.canNext&&(i+=r.maxShowThumbCount,t.setMargin(i))}}}}}]).directive("calWidth",function(){return{require:["^?imageBox","^?preImageBox"],restrict:"A",link:function(e,t,o,n){var r=t.width();n=n[0]||n[1],e.$watch("images",function(t){if(t){var o=n.thumbWidth*e.images.length-r;if(o>0){var i=parseInt(o/n.thumbWidth),a=o%n.thumbWidth;0!=a&&(o=n.thumbWidth*(i+1))}n.maxScrollWidth=o,n.maxShowThumbCount=parseInt(r/n.thumbWidth)}})}}}).directive("needScroll",function(){return{restrict:"A",link:function(e,t){var o=0;e.$watch("previewImg",function(e){if(e){var n=new Image;n.src=e,n.onload=function(){(this.height>document.body.clientHeight||o>document.body.clientHeight)&&window.scrollTo(0,t[0].offsetTop),o=this.height}}})}}}),angular.module("donler.components.report",[]).controller("ReportCtrl",["$scope","Report",function(e,t){this.pushReport=function(){t.publish(e.reportContent,function(e,t){alertify.alert(t)})},this.getReport=function(t,o,n){var r;r="user"==t?{poster:{nickname:n.name,_id:o,cid:n.cid},_id:o}:{poster:n.poster,content:n.content},e.reportContent={hostType:t,hostId:o,hostContent:r,reportType:""},angular.element("#report_modal").modal("show")}}]).directive("reportButton",function(){return{restrict:"E",replace:!0,scope:{hostType:"@",hostId:"@",hostContent:"="},template:'<a ng-click="getReport(hostType,hostId,hostContent)"> 举报</a>',require:"^reportContain",link:function(e,t,o,n){e.getReport=function(e,t,o){n.getReport(e,t,o)}}}}).directive("reportModal",function(){var e=!0;return{restrict:"E",replace:!0,scope:!0,templateUrl:"/component_templates/report_modal.html",require:"^reportContain",link:function(t,o,n,r){t.pushReport=function(){r.pushReport()},t.reportModalLoad=e,e&&(e=!1)}}}).directive("reportContain",function(){return{restrict:"A",controller:"ReportCtrl",link:function(){}}}),angular.module("donler.components.richComment",["angularFileUpload"]).filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("emoji",function(){var e=["bowtie","smile","laughing","blush","smiley","relaxed","smirk","heart_eyes","kissing_heart","kissing_closed_eyes","flushed","relieved","satisfied","grin","wink","stuck_out_tongue_winking_eye","stuck_out_tongue_closed_eyes","grinning","kissing","kissing_smiling_eyes","stuck_out_tongue","sleeping","worried","frowning","anguished","open_mouth","grimacing","confused","hushed","expressionless","unamused","sweat_smile","sweat","disappointed_relieved","weary","pensive","disappointed","confounded","fearful","cold_sweat","persevere","cry","sob","joy","astonished","scream","neckbeard","tired_face","angry","rage","triumph","sleepy","yum","mask","sunglasses","dizzy_face","imp","smiling_imp","neutral_face","no_mouth","innocent","alien","yellow_heart","blue_heart","purple_heart","heart","green_heart","broken_heart","heartbeat","heartpulse","two_hearts","revolving_hearts","cupid","sparkling_heart","sparkles","star","star2","dizzy","boom","collision","anger","exclamation","question","grey_exclamation","grey_question","zzz","dash","sweat_drops","notes","musical_note","fire","hankey","poop","shit","\\+1","thumbsup","-1","thumbsdown","ok_hand","punch","facepunch","fist","v","wave","hand","raised_hand","open_hands","point_up","point_down","point_left","point_right","raised_hands","pray","point_up_2","clap","muscle","metal","fu","walking","runner","running","couple","family","two_men_holding_hands","two_women_holding_hands","dancer","dancers","ok_woman","no_good","information_desk_person","raising_hand","bride_with_veil","person_with_pouting_face","person_frowning","bow","couplekiss","couple_with_heart","massage","haircut","nail_care","boy","girl","woman","man","baby","older_woman","older_man","person_with_blond_hair","man_with_gua_pi_mao","man_with_turban","construction_worker","cop","angel","princess","smiley_cat","smile_cat","heart_eyes_cat","kissing_cat","smirk_cat","scream_cat","crying_cat_face","joy_cat","pouting_cat","japanese_ogre","japanese_goblin","see_no_evil","hear_no_evil","speak_no_evil","guardsman","skull","feet","lips","kiss","droplet","ear","eyes","nose","tongue","love_letter","bust_in_silhouette","busts_in_silhouette","speech_balloon","thought_balloon","feelsgood","finnadie","goberserk","godmode","hurtrealbad","rage1","rage2","rage3","rage4","suspect","trollface","sunny","umbrella","cloud","snowflake","snowman","zap","cyclone","foggy","ocean","cat","dog","mouse","hamster","rabbit","wolf","frog","tiger","koala","bear","pig","pig_nose","cow","boar","monkey_face","monkey","horse","racehorse","camel","sheep","elephant","panda_face","snake","bird","baby_chick","hatched_chick","hatching_chick","chicken","penguin","turtle","bug","honeybee","ant","beetle","snail","octopus","tropical_fish","fish","whale","whale2","dolphin","cow2","ram","rat","water_buffalo","tiger2","rabbit2","dragon","goat","rooster","dog2","pig2","mouse2","ox","dragon_face","blowfish","crocodile","dromedary_camel","leopard","cat2","poodle","paw_prints","bouquet","cherry_blossom","tulip","four_leaf_clover","rose","sunflower","hibiscus","maple_leaf","leaves","fallen_leaf","herb","mushroom","cactus","palm_tree","evergreen_tree","deciduous_tree","chestnut","seedling","blossom","ear_of_rice","shell","globe_with_meridians","sun_with_face","full_moon_with_face","new_moon_with_face","new_moon","waxing_crescent_moon","first_quarter_moon","waxing_gibbous_moon","full_moon","waning_gibbous_moon","last_quarter_moon","waning_crescent_moon","last_quarter_moon_with_face","first_quarter_moon_with_face","moon","earth_africa","earth_americas","earth_asia","volcano","milky_way","partly_sunny","octocat","squirrel","bamboo","gift_heart","dolls","school_satchel","mortar_board","flags","fireworks","sparkler","wind_chime","rice_scene","jack_o_lantern","ghost","santa","christmas_tree","gift","bell","no_bell","tanabata_tree","tada","confetti_ball","balloon","crystal_ball","cd","dvd","floppy_disk","camera","video_camera","movie_camera","computer","tv","iphone","phone","telephone","telephone_receiver","pager","fax","minidisc","vhs","sound","speaker","mute","loudspeaker","mega","hourglass","hourglass_flowing_sand","alarm_clock","watch","radio","satellite","loop","mag","mag_right","unlock","lock","lock_with_ink_pen","closed_lock_with_key","key","bulb","flashlight","high_brightness","low_brightness","electric_plug","battery","calling","email","mailbox","postbox","bath","bathtub","shower","toilet","wrench","nut_and_bolt","hammer","seat","moneybag","yen","dollar","pound","euro","credit_card","money_with_wings","e-mail","inbox_tray","outbox_tray","envelope","incoming_envelope","postal_horn","mailbox_closed","mailbox_with_mail","mailbox_with_no_mail","door","smoking","bomb","gun","hocho","pill","syringe","page_facing_up","page_with_curl","bookmark_tabs","bar_chart","chart_with_upwards_trend","chart_with_downwards_trend","scroll","clipboard","calendar","date","card_index","file_folder","open_file_folder","scissors","pushpin","paperclip","black_nib","pencil2","straight_ruler","triangular_ruler","closed_book","green_book","blue_book","orange_book","notebook","notebook_with_decorative_cover","ledger","books","bookmark","name_badge","microscope","telescope","newspaper","football","basketball","soccer","baseball","tennis","8ball","rugby_football","bowling","golf","mountain_bicyclist","bicyclist","horse_racing","snowboarder","swimmer","surfer","ski","spades","hearts","clubs","diamonds","gem","ring","trophy","musical_score","musical_keyboard","violin","space_invader","video_game","black_joker","flower_playing_cards","game_die","dart","mahjong","clapper","memo","pencil","book","art","microphone","headphones","trumpet","saxophone","guitar","shoe","sandal","high_heel","lipstick","boot","shirt","tshirt","necktie","womans_clothes","dress","running_shirt_with_sash","jeans","kimono","bikini","ribbon","tophat","crown","womans_hat","mans_shoe","closed_umbrella","briefcase","handbag","pouch","purse","eyeglasses","fishing_pole_and_fish","coffee","tea","sake","baby_bottle","beer","beers","cocktail","tropical_drink","wine_glass","fork_and_knife","pizza","hamburger","fries","poultry_leg","meat_on_bone","spaghetti","curry","fried_shrimp","bento","sushi","fish_cake","rice_ball","rice_cracker","rice","ramen","stew","oden","dango","egg","bread","doughnut","custard","icecream","ice_cream","shaved_ice","birthday","cake","cookie","chocolate_bar","candy","lollipop","honey_pot","apple","green_apple","tangerine","lemon","cherries","grapes","watermelon","strawberry","peach","melon","banana","pear","pineapple","sweet_potato","eggplant","tomato","corn","house","house_with_garden","school","office","post_office","hospital","bank","convenience_store","love_hotel","hotel","wedding","church","department_store","european_post_office","city_sunrise","city_sunset","japanese_castle","european_castle","tent","factory","tokyo_tower","japan","mount_fuji","sunrise_over_mountains","sunrise","stars","statue_of_liberty","bridge_at_night","carousel_horse","rainbow","ferris_wheel","fountain","roller_coaster","ship","speedboat","boat","sailboat","rowboat","anchor","rocket","airplane","helicopter","steam_locomotive","tram","mountain_railway","bike","aerial_tramway","suspension_railway","mountain_cableway","tractor","blue_car","oncoming_automobile","car","red_car","taxi","oncoming_taxi","articulated_lorry","bus","oncoming_bus","rotating_light","police_car","oncoming_police_car","fire_engine","ambulance","minibus","truck","train","station","train2","bullettrain_front","bullettrain_side","light_rail","monorail","railway_car","trolleybus","ticket","fuelpump","vertical_traffic_light","traffic_light","warning","construction","beginner","atm","slot_machine","busstop","barber","hotsprings","checkered_flag","crossed_flags","izakaya_lantern","moyai","circus_tent","performing_arts","round_pushpin","triangular_flag_on_post","jp","kr","cn","us","fr","es","it","ru","gb","uk","de","one","two","three","four","five","six","seven","eight","nine","keycap_ten","1234","zero","hash","symbols","arrow_backward","arrow_down","arrow_forward","arrow_left","capital_abcd","abcd","abc","arrow_lower_left","arrow_lower_right","arrow_right","arrow_up","arrow_upper_left","arrow_upper_right","arrow_double_down","arrow_double_up","arrow_down_small","arrow_heading_down","arrow_heading_up","leftwards_arrow_with_hook","arrow_right_hook","left_right_arrow","arrow_up_down","arrow_up_small","arrows_clockwise","arrows_counterclockwise","rewind","fast_forward","information_source","ok","twisted_rightwards_arrows","repeat","repeat_one","new","top","up","cool","free","ng","cinema","koko","signal_strength","u5272","u5408","u55b6","u6307","u6708","u6709","u6e80","u7121","u7533","u7a7a","u7981","sa","restroom","mens","womens","baby_symbol","no_smoking","parking","wheelchair","metro","baggage_claim","accept","wc","potable_water","put_litter_in_its_place","secret","congratulations","m","passport_control","left_luggage","customs","ideograph_advantage","cl","sos","id","no_entry_sign","underage","no_mobile_phones","do_not_litter","non-potable_water","no_bicycles","no_pedestrians","children_crossing","no_entry","eight_spoked_asterisk","eight_pointed_black_star","heart_decoration","vs","vibration_mode","mobile_phone_off","chart","currency_exchange","aries","taurus","gemini","cancer","leo","virgo","libra","scorpius","sagittarius","capricorn","aquarius","pisces","ophiuchus","six_pointed_star","negative_squared_cross_mark","a","b","ab","o2","diamond_shape_with_a_dot_inside","recycle","end","on","soon","clock1","clock130","clock10","clock1030","clock11","clock1130","clock12","clock1230","clock2","clock230","clock3","clock330","clock4","clock430","clock5","clock530","clock6","clock630","clock7","clock730","clock8","clock830","clock9","clock930","heavy_dollar_sign","copyright","registered","tm","x","heavy_exclamation_mark","bangbang","interrobang","o","heavy_multiplication_x","heavy_plus_sign","heavy_minus_sign","heavy_division_sign","white_flower","100","heavy_check_mark","ballot_box_with_check","radio_button","link","curly_loop","wavy_dash","part_alternation_mark","trident","black_square","white_square","white_check_mark","black_square_button","white_square_button","black_circle","white_circle","red_circle","large_blue_circle","large_blue_diamond","large_orange_diamond","small_blue_diamond","small_orange_diamond","small_red_triangle","small_red_triangle_down","shipit"],t=new RegExp(":("+e.join("|")+"):","g");return function(e){return e.replace(t,function(e,t){return"<i class='emoji emoji_"+t+"' title=':"+t+":'>"+t+"</i>"})}}).controller("RichCommentCtrl",["$scope","$http","$element","$timeout","Comment","Report","FileUploader",function(e,t,o,n,r,i,a){e.pages=[],e.nowPage=0,e.showMoreComment=!1;var s=function(t){Object.defineProperty(this,"photo_album_id",{set:function(e){this.uploader.url="/photoAlbum/"+e+"/photo/single"}}),t&&(this.host_type=t.host_type,this.host_id=t.host_id,this.photo_album_id=t.photo_album_id);var o=new a({url:this.photo_album_id?"/photoAlbum/"+this.photo_album_id+"/photo/single":null});o.filters.push({name:"imageFilter",fn:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}}),o.onAfterAddingAll=function(){e.afterRender&&n(function(){e.afterRender()})},this.uploader=o};s.prototype.publish=function(t,o){if(t||""!==t){var i=this;if(i.uploader.getNotUploadedItems().length>0){if(!this.uploader.url||""===this.uploader.url)return;i.uploader.uploadAll(),i.uploader.onSuccessItem=function(){e.afterRender&&n(function(){e.afterRender()})},i.uploader.onCompleteAll=function(){r.publish({host_id:i.host_id,host_type:i.host_type,content:t},function(e,t){i.uploader.clearQueue(),o(e,t)})}}else r.publish({host_id:i.host_id,host_type:i.host_type,content:t},function(e,t){i.uploader.clearQueue(),o(e,t)})}};var c=new s;e.uploader=c.uploader,e.publish=function(t,o){c.publish(t,function(t,r){t?console.log(t):(e.comments.unshift({_id:r._id,host_id:r.host_id,content:r.content,create_date:r.create_date,poster:r.poster,photos:r.photos,host_type:r.host_type,delete_permission:!0}),e.new_comment.text="",o.$setPristine(),e.afterRender&&n(function(){e.afterRender()}))})},e.componentId&&t.get("/components/RichComment/id/"+e.componentId).success(function(t){1===t.result&&(c.host_type=t.componentData.hostType,c.host_id=t.componentData.hostId,c.photo_album_id=t.componentData.photoAlbumId,e.photoAlbumId=t.componentData.photoAlbumId,e.userPhoto=t.componentData.userPhoto,e.gotComponentData=!0,r.get("campaign",c.host_id,function(t,o,r){if(t)alertify.alert("获取评论失败，请刷新页面重试");else{if(e.comments=o,!e.pages[e.nowPage]){var i={nextStartDate:r};e.comments[0]&&(i.thisStartDate=e.comments[0].create_date),e.pages.push(i)}e.afterRender&&n(function(){e.afterRender()})}}))}).error(function(){alertify.alert("获取评论失败，请刷新页面重试")}),e.new_comment={text:""};var l=function(e){r.getReplies(e._id,function(t,o){e.replies=o,e.reply_count=o.length})};e.last_reply_comment,e.toggleComment=function(t){e.last_reply_comment&&e.last_reply_comment!=t&&(e.last_reply_comment.replying=!1),t.replying=!t.replying,e.last_reply_comment=t,t.replying&&(l(t),e.now_reply_to={_id:t.poster._id,nickname:t.poster.nickname},e.afterRender&&n(function(){e.afterRender()}))},e.setReplyTo=function(t,o,n){e.last_reply_comment!=t&&(e.last_reply_comment.replying=!1,e.last_reply_comment=t),t.replying||(t.replying=!0),e.now_reply_to={_id:o,nickname:n}},e.reply=function(t,o){t.new_reply&&""!==t.new_reply&&r.reply(t._id,e.now_reply_to._id,t.new_reply,function(r,i){r||(t.replies||(t.replies=[]),t.replies.push(i),t.reply_count++,t.new_reply="",o.$setPristine(),e.afterRender&&n(function(){e.afterRender()}))})},e.deleteComment=function(t){alertify.confirm("确认要删除该评论吗？",function(o){if(o)try{r.remove(e.comments[t]._id,function(o){o?alertify.alert("删除失败，请重试。"):(e.comments.splice(t,1),e.afterRender&&n(function(){e.afterRender()}))})}catch(o){console.log(o)}})},e.removeReply=function(t,o){alertify.confirm("确认要删除该回复吗？",function(i){if(i){var a=t.replies[o];r.remove(a._id,function(r){r?alertify.alert("删除失败，请重试。"):(t.replies.splice(o,1),t.reply_count--,e.afterRender&&n(function(){e.afterRender()}))})}})},e.nextPage=function(){r.get("campaign",c.host_id,function(t,o,n){if(t)alertify.alert("获取评论失败，请刷新页面重试");else if(e.comments=o,e.nowPage++,!e.pages[e.nowPage]){var r={thisStartDate:e.pages[e.nowPage-1].nextStartDate,nextStartDate:n};e.pages.push(r)}},e.pages[e.nowPage].nextStartDate)},e.lastPage=function(){r.get("campaign",c.host_id,function(t,o){t?alertify.alert("获取评论失败，请刷新页面重试"):(e.comments=o,e.nowPage--)},e.pages[e.nowPage-1].thisStartDate)},e.changePage=function(t){r.get("campaign",c.host_id,function(o,n){o?alertify.alert("获取评论失败，请刷新页面重试"):(e.comments=n,e.nowPage=t)},e.pages[t].thisStartDate)},e.showMore=function(){e.showMoreComment=!0,e.afterRender&&n(function(){e.afterRender()})},e.originPlaceholder="输入内容请控制在140字以内",e.currentPlaceholder={comment:e.originPlaceholder,reply:e.originPlaceholder}}]).directive("simpleComment",function(){return{restrict:"E",replace:!0,controller:"RichCommentCtrl",scope:{componentId:"@",photoAlbumId:"@",allowPublish:"@",commentNum:"@",afterRender:"&"},templateUrl:"/component_templates/simple_comment.html"}}).directive("richComment",function(){return{restrict:"E",replace:!0,controller:"RichCommentCtrl",scope:{componentId:"@",photoAlbumId:"@",allowPublish:"@"},templateUrl:"/component_templates/rich_comment.html"}}).directive("toggleFocus",function(){return{restrict:"A",scope:{toggleFocus:"="},link:function(e,t){e.$watch("toggleFocus",function(e){e===!0&&t.focus()})}}}),angular.module("donler.components.scoreBoard",[]).controller("ScoreBoardCtrl",["$scope","ScoreBoard",function(e,t){e.leaderStatus="init",e.allowEdit=!1,e.allowManage=!1;var o=function(){t.getData(e.componentId,function(t,o){if(t)alertify.alert(t);else if(e.scoreBoard=o,e.scoreBoard.effective){e.scores=[],e.results=[];for(var n=0;n<e.scoreBoard.playingTeams.length;n++){var r=e.scoreBoard.playingTeams[n];e.scores.push(r.score),e.results.push(r.result),1===e.scoreBoard.status?r.allowManage&&(e.allowEdit=!0,e.leaderStatus=r.confirm?"waitConfirm":"toConfirm"):0===e.scoreBoard.status&&r.allowManage&&(e.allowEdit=!0),r.allowManage&&(e.allowManage=!0)}}})};o(),e.editing=!1,e.setResult=function(t,o){0===o?(e.results[0]=t,e.results[1]=0-t):1===o&&(e.results[0]=0-t,e.results[1]=t)},e.toggleEdit=function(){e.editing=!e.editing};var n=function(){e.editing=!1,1===e.scoreBoard.status,e.leaderStatus="waitConfirm";for(var t=0;t<e.scoreBoard.playingTeams.length;t++){var o=e.scoreBoard.playingTeams[t];o.score=e.scores[t],o.result=e.results[t]}};e.initScore=function(){t.initScore(e.componentId,{scores:e.scores,results:e.results},function(e){e?alertify.alert(e):n()})},e.resetScore=function(){t.resetScore(e.componentId,{scores:e.scores,results:e.results},function(e){e?alertify.alert(e):n()})},e.confirmScore=function(){var o="提示：同意后将无法修改，确定要同意吗？";alertify.confirm(o,function(o){o&&t.confirmScore(e.componentId,function(t){t?alertify.alert(t):(e.scoreBoard.allConfirm=!0,e.leaderStatus="confirm",e.scoreBoard.status=2)})})},e.showLogs=!1,e.toggleLogs=function(){e.showLogs?e.showLogs=!1:t.getLogs(e.componentId,function(t,o){t?alertify.alert(t):(e.logs=o,e.showLogs=!0)})}}]).factory("ScoreBoard",["$http",function(e){var t=function(t,o,n,r){e.post("/components/ScoreBoard/id/"+t+"/setScore",{data:o,isInit:n}).success(function(e){1===e.result?r():r(e.msg)}).error(function(){r("设置失败")})};return{getData:function(t,o){e.get("/components/ScoreBoard/id/"+t).success(function(e){1===e.result?o(null,e.componentData):o("获取比分失败，请刷新页面重试")}).error(function(){o("获取比分失败，请刷新页面重试")})},initScore:function(e,o,n){t(e,o,!0,n)},resetScore:function(e,o,n){t(e,o,!1,n)},confirmScore:function(t,o){e.post("/components/ScoreBoard/id/"+t+"/confirmScore").success(function(e){1===e.result?o():o(e.msg)}).error(function(){o("操作失败，请重试。")})},getLogs:function(t,o){e.get("/components/ScoreBoard/id/"+t+"/getLogs").success(function(e){1===e.result?o(null,e.logs):o(e.msg)}).error(function(){o("获取记录失败，请重试。")})}}}]).directive("scoreBoard",function(){return{restrict:"E",replace:!0,controller:"ScoreBoardCtrl",templateUrl:"/component_templates/score_board.html",scope:{componentId:"@"}}}),angular.module("donler",["ngRoute","ui.bootstrap","pascalprecht.translate","wu.masonry","angular-carousel","donler.components"]);var app=angular.module("donler");app.directive("match",["$parse",function(e){return{require:"ngModel",link:function(t,o,n,r){t.$watch(function(){return e(n.match)(t)===r.$modelValue},function(e){r.$setValidity("mismatch",e)})}}}]),app.directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){e.$watch("member_max",function(){void 0!=e.member_min&&n.$setViewValue(n.$viewValue)});var r=function(t){var r=e.$eval(o.ngMin)||0;return r>t?(n.$setValidity("ngMin",!1),t):(n.$setValidity("ngMin",!0),t)};n.$parsers.push(r),n.$formatters.push(r)}}}),app.directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){e.$watch("member_min",function(){void 0!=e.member_max&&n.$setViewValue(n.$viewValue)});var r=function(t){var r=e.$eval(o.ngMax)||1/0;return t>r?(n.$setValidity("ngMax",!1),t):(n.$setValidity("ngMax",!0),t)};n.$parsers.push(r),n.$formatters.push(r)}}}),app.directive("bsPopover",function(){return{controller:["$http","$scope",function(e,t){t.showUserCard=function(o,n){t.member_id===o?$("#pop"+n).dl_card({content:t.htmlcontent}):(t.member_id=o,e.get("/users/briefInfo/"+o).success(function(e){t.htmlcontent=e,$("#pop"+n).dl_card({content:e})}))},t.showGroupCard=function(o,n){t.group_id===o?$("#pop"+n).dl_card({content:t.htmlcontent}):(t.group_id=o,e.get("/group/briefInfo/"+o).success(function(e){$("#pop"+n).dl_card({content:e}),t.htmlcontent=e}))}}]}}),app.directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r;if(n){n.$render=function(){return t.html(n.$viewValue)};var i=function(){var i=$.trim(t.html());return n.$viewValue!==i?(i.replace(/<\/?[^>]*>/g,"").replace(/[\u4e00-\u9fa5]/g,"**").length>o.mixMaxlength?n.$setValidity("mixlength",!1):n.$setValidity("mixlength",!0),e.$apply(r)):void 0},a=function(e){var t=e.currentTarget.innerHTML;setTimeout(function(){for(var o=e.currentTarget.innerHTML,n=-1,r=-1,a=0;a<o.length;a++)-1==n&&t.substr(a,1)!=o.substr(a,1)&&(n=a),-1==r&&t.substr(t.length-a-1,1)!=o.substr(o.length-a-1,1)&&(r=a);var s=o.substr(n,o.length-r-n),c=s.replace(/style\s*=(['\"\s]?)[^'\"]*?\1/gi,"").replace(/class\s*=(['\"\s]?)[^'\"]*?\1/gi,""),l=o.substr(0,n)+c+o.substr(n+s.length);e.currentTarget.innerHTML=l,i(e)},100)};return t.bind("focus",function(){t.bind("input",i),t.bind("keydown",i),t.bind("paste",a)}),t.bind("blur",function(e){t.unbind("input",i),t.unbind("keydown",i),t.unbind("paste",a),i(e)}),r=function(){return n.$setViewValue($.trim(t.html()))}}}}}),app.directive("mixMaxlength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,o,n){var r=parseInt(o.mixMaxlength)||10;e.$watch(o.ngModel,function(e){e&&e.replace(/[\u4e00-\u9fa5]/g,"**").length>r?(n.$setValidity("mixlength",!1),t[0].onkeydown=function(e){switch(e.keyCode){case 8:case 46:break;default:e.preventDefault()}}):(n.$setValidity("mixlength",!0),t[0].onkeydown=null)})}}}),app.directive("bootstrapTagsinput",[function(){function e(e,t){return t?angular.isFunction(e.$parent[t])?e.$parent[t]:function(e){return e[t]}:void 0}return{restrict:"EA",scope:{model:"=ngModel"},template:"<select multiple></select>",replace:!1,link:function(t,o,n){$(function(){angular.isArray(t.model)||(t.model=[]);var r=$("select",o),i=n.typeaheadSource?n.typeaheadSource.split("."):null,a=i?i.length>1?t.$parent[i[0]][i[1]]:t.$parent[i[0]]:null;r.tagsinput(t.$parent[n.options||""]||{typeahead:{source:angular.isFunction(a)?a:null},itemValue:e(t,n.itemvalue),itemText:e(t,n.itemtext),confirmKeys:e(t,n.confirmkeys)?JSON.parse(n.confirmkeys):[13],tagClass:angular.isFunction(t.$parent[n.tagclass])?t.$parent[n.tagclass]:function(){return n.tagclass}});for(var s=0;s<t.model.length;s++)r.tagsinput("add",t.model[s]);r.on("itemAdded",function(e){-1===t.model.indexOf(e.item)&&t.model.push(e.item)}),r.on("itemRemoved",function(e){var o=t.model.indexOf(e.item);-1!==o&&t.model.splice(o,1)});var c=t.model.slice();t.$watch("model",function(){var e,o=t.model.filter(function(e){return-1===c.indexOf(e)}),n=c.filter(function(e){return-1===t.model.indexOf(e)});for(c=t.model.slice(),e=0;e<n.length;e++)r.tagsinput("remove",n[e]);for(r.tagsinput("refresh"),e=0;e<o.length;e++)r.tagsinput("add",o[e])},!0)})}}}]),app.directive("ngThumb",["$window",function(e){var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}};return{restrict:"A",template:"<canvas/>",link:function(e,o,n){function r(e){var t=new Image;t.onload=i,t.src=e.target.result}function i(){var e=a.width||this.width/this.height*a.height,t=a.height||this.height/this.width*a.width;s.attr({width:e,height:t}),s[0].getContext("2d").drawImage(this,0,0,e,t)}if(t.support){var a=e.$eval(n.ngThumb);if(t.isFile(a.file)&&t.isImage(a.file)){var s=o.find("canvas"),c=new FileReader;c.onload=r,c.readAsDataURL(a.file)}}}}}]),app.run(["$rootScope","anchorSmoothScroll",function(e,t){alertify.set({buttonFocus:"none",labels:{ok:"确认",cancel:"取消"}}),e.bakckTop=function(){t.scrollTo(0)},e.shortTrim=function(e){return escape(e).indexOf("%u")>=0?e.length>6?e.substr(0,6)+"...":e:e.length>15?e.substr(0,15)+"...":e}}]),app.filter("dateView",function(){return function(e){var t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0);var o=new Date(e),n=o.getTime()-t.getTime(),r=Math.floor(n/864e5),i=(o.getHours()<10?"0"+o.getHours():o.getHours())+":"+(o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes());switch(r){case-2:return"前天"+i;case-1:return"昨天"+i;case 0:return"今天"+i;case 1:return"明天"+i;case 2:return"后天"+i;default:return e}}}),app.filter("day",function(){return function(e){var t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0);var o=new Date(e),n=o.getTime()-t.getTime(),r=Math.floor(n/864e5);switch(r){case-1:return"昨天";case 0:return"今天";case 1:return"明天";default:return o.getMonth()+1+"-"+o.getDate()}}}),app.filter("week",function(){return function(e){switch(new Date(e).getDay()){case 0:e="周日";break;case 1:e="周一";break;case 2:e="周二";break;case 3:e="周三";break;case 4:e="周四";break;case 5:e="周五";break;case 6:e="周六";break;default:e=""}return e}}),app.filter("monthPrefixZero",function(){return function(e){return 10>e?"0"+e:e}});var messageApp=angular.module("donler");messageApp.run(["$http","$rootScope",function(e,t){t.o=0}]),messageApp.controller("messageHeaderController",["$scope","$http","$rootScope",function(e,t,o){"/message/home"!=location.pathname&&t.get("/message/header").success(function(e){var t=e.msg;o.o=t.length})}]),angular.module("donler").factory("Campaign",["$http",function(e){var t=function(t,o,n){try{e({method:"post",url:t,data:o}).success(function(e){1===e.result?n(null,e):n("活动发布出错 "+e.msg)}).error(function(){n("error")})}catch(r){console.log(r)}},o=function(t,o,n){e.get("/"+t+"/getTags/"+o).success(function(e){n(null,e)}).error(function(){n("error")})},n=function(t,o,n){e.get("/campaign/getMolds/"+t+"/"+o).success(function(e){0===e.result?n(e.msg):n(null,e)}).error(function(){n("error")})},r=function(t,o){e.post("/campaign/joinCampaign/"+t.campaignId,{cid:t.cid,tid:t.tid}).success(function(e){1===e.result?o():o(e.msg)}).error(function(){o("参加失败，请重试。")})},i=function(t,o){e.post("/campaign/quitCampaign/"+t).success(function(e){1===e.result?o():o(e.msg)}).error(function(){o("退出失败，请重试。")})},a=function(t,o,n){e.post("/campaign/edit/"+t,o).success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("编辑失败，请重试。")})},s=function(t,o){e.post("/campaign/cancel/"+t).success(function(e){1===e.result?o():o(e.msg)}).error(function(){o("关闭活动失败，请重试。")})},c=function(t,o,n,r){e({method:"post",url:"/campaign/dealProvoke/"+t,data:{tid:o,responseStatus:n}}).success(function(e){1===e.result?r():r(e.msg)}).error(function(){r("DATA ERROR")})},l=function(t,o){if(t)var n="/group/getLedTeams/"+t;else var n="/group/getLedTeams";e.get(n).success(function(e){0===e.result?o(e.msg):o(null,e)
})},u=function(t,o,n,r){var i="";n&&n.year&&n.month&&(i="?year="+n.year+"&month="+n.month),e.get("/campaign/getCampaignData/"+t+"/"+o+i).success(function(e){1===e.result?r(null,e.timeLine):r(e.msg)}).error(function(){r("error")})},d=function(t,o,n){e.get("/campaign/getDateRecord/"+t+"/"+o).success(function(e){1===e.result?n(null,e.dateRecord):n(e.msg)}).error(function(){n("error")})},p=function(t,o){e.get("/campaign/"+t+"/pageData").success(function(e){1===e.result?o(null,{campaign:e.campaign,allow:e.allow}):o("error")}).error(function(){o("error")})},m=function(t,o){e.get("/campaign/"+t+"/members").success(function(e){1===e.result?o(null,e.units,e.memberCount):o("error")}).error(function(){o("error")})},f=function(t,o){e.get("/campaign/"+t+"/notices").success(function(e){1===e.result?o(null,e.notices):o("error")}).error(function(){o("error")})};return{sponsor:t,getTags:o,join:r,quit:i,edit:a,cancel:s,getMolds:n,dealProvoke:c,getLedTeams:l,getCampaignsData:u,getCampaignsDateRecord:d,getDetailPageData:p,getMembers:m,getNotices:f}}]),angular.module("donler").factory("Comment",["$http",function(e){var t=function(t,o,n,r,i){e.post("/comment/pull/"+t+"/"+o,{create_date:r,num:i}).success(function(e){n(null,e.comments,e.nextStartDate)}).error(function(){n("error")})},o=function(t,o){e.post("/comment/push/"+t.host_type+"/"+t.host_id,t).success(function(e){"SUCCESS"===e.msg?o(null,e.comment):o("error")}).error(function(){o("error")})},n=function(t,o){e.delete("/comment/"+t).success(function(e){1===e.result?o():o("error")}).error(function(){o("error")})},r=function(t,o,n,r){e.post("/comment/"+t+"/reply",{to:o,content:n}).success(function(e){1===e.result?r(null,e.reply):r("error")}).error(function(){r("error")})},i=function(t,o){e.get("/comment/"+t+"/replies").success(function(e){1===e.result?o(null,e.replies):o("error")}).error(function(){o("error")})};return{get:t,publish:o,reply:r,remove:n,getReplies:i}}]),angular.module("donler").factory("PhotoAlbum",["$http",function(e){var t=function(e){this.id=e};return t.prototype.getInfo=function(t){e.get("/photoAlbum/"+this.id).success(function(e){1===e.result?t(null,e.data):t(e.msg)}).error(function(){t("error")})},t.prototype.getPhotos=function(t){e.get("/photoAlbum/"+this.id+"/photolist").success(function(e){1===e.result?t(null,e.data):t(e.msg,[])}).error(function(){t("error",[])})},t.prototype.changeName=function(t){var o=this;return function(n){e.put("/photoAlbum/"+o.id,{name:n}).success(function(e){1===e.result?t(null,e.data):t(e.msg)}).error(function(){t("error")})}},t.prototype.delete=function(t){e.delete("/photoAlbum/"+this.id).success(function(e){1===e.result?t():t(e.msg)}).error(function(){t("error")})},t}]),angular.module("donler").factory("Report",["$http",function(e){var t=function(t,o){e.post("/report/push/",t).success(function(e){1===e.result?o(null,e.msg):o("error",e.msg)}).error(function(){o("error","数据发送错误")})};return{publish:t}}]),angular.module("donler").factory("Search",["$http",function(e){var t=function(t,o,n){try{e.get("/search/sameCityTeam/"+t+"?page="+o).success(function(e){n(null,e)}).error(function(){n("error")})}catch(r){console.log(r),n("error")}},o=function(t,o,n,r){try{e.get("/search/nearbyTeam/"+t+"?page="+o+"&index="+n).success(function(e){r(null,e)}).error(function(){r("error")})}catch(i){console.log(i),r("error")}},n=function(t,o){e.get("/group/opponentInfo/"+t).success(function(e){o(null,e)}).error(function(){o("error")})},r=function(t,o,n,r){e.get("/search/keywordSearch/"+t+"?key="+o+"&page="+n).success(function(e){r(null,e)}).error(function(){r("error")})};return{searchSameCity:t,getOpponentInfo:n,searchNearby:o,searchTeam:r}}]),angular.module("donler").service("anchorSmoothScroll",function(){this.scrollTo=function(e){function t(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function o(e){var t=document.getElementById(e);if(!t)return 0;for(var o=t.offsetTop,n=t;n.offsetParent&&n.offsetParent!=document.body;)n=n.offsetParent,o+=n.offsetTop;return o}var n,r,i,a=20;if(n=t(),r=o("number"==typeof e?e:e),i=r>n?r-n:n-r,100>i)return window.scrollByU=!0,void scrollTo(0,r);var s=Math.round(i/200);s>=a&&(s=a);var c=Math.round(i/25),l=r>n?n+c:n-c,u=0;if(r>n)for(var d=n;r>d;d+=c)setTimeout("window.scrollByU =true;window.scrollTo(0, "+l+")",u*s),l+=c,l>r&&(l=r),u++;else for(var d=n;d>r;d-=c)setTimeout("window.scrollByU =true;window.scrollTo(0, "+l+")",u*s),l-=c,r>l&&(l=r),u++}});var donler=angular.module("donler");donler.factory("Team",["$http",function(e){return{getTeamInfo:function(t,o){e.get("/group/"+t+"/info").success(function(e){1===e.result?o(null,{team:e.team,allow:e.allow,isShowHomeCourts:e.isShowHomeCourts,role:e.role,is_one_button:e.is_one_button}):o("error")}).error(function(){o("error")})},getTeamMembers:function(t,o){e.get("/group/"+t+"/members").success(function(e){1===e.result?o(null,e.members):o("error")}).error(function(){o("error")})},join:function(t,o){e.post("/users/joinGroup",{tid:t}).success(function(e){1===e.result?o():o("error")}).error(function(){o("error")})},quit:function(t,o){e.post("/users/quitGroup",{tid:t}).success(function(e){1===e.result?o():o("error")}).error(function(){o("error")})},saveInfo:function(t,o,n){var r;if(o.homecourt){r=o.homecourt;for(var i=0;i<r.length;i++)r[i].name||r.splice(i,1)}e.post("/group/saveInfo/"+t,{name:o.name,brief:o.brief,homecourt:r}).success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("error")})},active:function(t,o,n){e.post("/group/activateGroup/"+t,{active:o}).success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("error")})}}}]),angular.module("donler").directive("countDown",function(){return{restrict:"A",scope:{endText:"@",target:"=",isEnd:"=",startCal:"="},link:function(e,t){var o=e.endText?e.endText:"活动已开始";e.$watch("target",function(n){if(n){r&&clearInterval(r);var r=setInterval(function(){var i=new Date(n);if(i.setSeconds(i.getSeconds()),i<Date.now())return t.text(o),e.isEnd=!0,e.$apply(),void clearInterval(r);var a=moment.duration(moment(i).diff(Date.now())),s="",c=!1,l=0,u=!1,d=function(e,t){var o=e+t;e>0?(c||(c=!0),u||(s+=o,l+=1,l>=2&&(u=!0))):c&&(l+=1,l>=2&&(u=!0))};d(a.years(),"年"),d(a.months(),"个月"),d(a.days(),"天"),d(a.hours(),"小时"),d(a.minutes(),"分"),d(a.seconds(),"秒"),t.text(s),e.startCal===!1&&(e.startCal=!0,e.$apply())},1e3)}})}}}),function(e){e(function(){var t,o=e("#logo"),n=e("#preview_big"),r=e("#preview_middle"),i=e("#preview_small"),a=e("#save_button"),s=e("#remind"),c=e("#return_uri").val(),l=e("#jcrop_img"),u=function(e,t){var o=e.files[0],n=new FileReader;n.readAsDataURL(o),n.onload=function(){t(this.result)}};o.change(function(){if(null===o.val()||""===o.val())a[0].disabled=!0;else{if(-1===o[0].files[0].type.indexOf("image"))return a[0].disabled=!0,void s.text("请选择图片文件");if(o[0].files[0].size>5242880)return a[0].disabled=!0,void s.text("上传的文件大小不可以超过5M");a[0].disabled=!1}u(o[0],function(o){l[0].onload=function(){var o=function(t){var o=l.width(),a=l.height();e("#w").val(t.w/o),e("#h").val(t.h/a),e("#x").val(t.x/o),e("#y").val(t.y/a);for(var s=[n,r,i],c=[150,50,27],u=0;u<s.length;u++){var d=c[u]/t.w,p=c[u]/t.h;s[u].css({width:Math.round(d*o)+"px",height:Math.round(p*a)+"px",marginLeft:"-"+Math.round(d*t.x)+"px",marginTop:"-"+Math.round(p*t.y)+"px"})}},a=l.width(),s=l.height();n.width(a).height(s),r.width(a).height(s),i.width(a).height(s),l.Jcrop({setSelect:[0,0,128,128],aspectRatio:1,onSelect:o,onChange:o},function(){t=this})},t&&(t.destroy(),l.attr("style","")),l.attr("src",o),n.attr("src",o),r.attr("src",o),i.attr("src",o)})}),e("#edit_logo_form").ajaxForm(function(t,o){if("success"===o&&1===t.result){var n={border:"1px","border-radius":"0px",top:"50px",left:"55%",width:"350px"},r={"border-top":"0px",background:"#fff","text-align":"center"},i={"margin-left":"0px",padding:"6px 15px","box-shadow":"0px 0px 0px #ffffff","background-color":"#3498db"};e(".alertify-buttons").css(r),e(".alertify").css(n),e(".alertify-button").css(i),window.location=c}else e("#loading_modal").modal("hide"),alertify.alert("修改失败，请重试!")}),e("#edit_logo_form").submit(function(){return e("#loading_modal").modal(),e(this).ajaxSubmit(),!1})})}(jQuery),function(e){var t,o,n,r=[],i=[],a={},s=function(t,n){var r,i,a,s,c,l,u,d,p,m,f,h,g,_,b,w,v=5,y=!1;r=e(document).scrollTop(),i=e(document).scrollLeft(),a=e(window).height(),s=e(window).width(),c=t.offset(),l=t.outerHeight(),u=t.outerWidth(),m=n.outerHeight(),f=n.outerWidth(),c.top-r-m-v>=0&&(s+i-c.left-f>=0?(d=c.top-m-v,p=c.left,y=!0,w="b"):c.left+u-i-f>=0&&(d=c.top-m-v,p=c.left+u-f,y=!0,w="b",o.find(".arrow").css({left:"auto",right:"20px"}))),y||a-(c.top+l-r)-m-v>=0&&(s+i-c.left-f>=0?(d=c.top+l+v,p=c.left,y=!0,w="t"):c.left+u-i-f>=0&&(d=c.top+l+v,p=c.left+u-f,y=!0,w="t",o.find(".arrow").css({left:"auto",right:"20px"}))),y||s+i-c.left-u-f-v>=0&&(c.top+l-r-m>=0?(d=c.top+l-m,p=c.left+u+v,y=!0,w="l",o.find(".arrow").css({top:"auto",bottom:"20px"})):c.top+a-r-m>=0&&(d=c.top,p=c.left+u+v,y=!0,w="l")),y||c.left-i-f-v>=0&&(a-(c.top-r)-m>=0?(d=c.top,p=c.left-f-v,y=!0,w="r"):c.top+l-r-m>=0&&(d=c.top+l-m,p=c.left-f-v,y=!0,w="r",o.find(".arrow").css({top:"auto",bottom:"20px"}))),y||(h=c.top-r+l/2,_=a-h,b=c.left-i+u/2,g=s-b,h>=_?g>=b?m>h&&g>=f?(d=c.top+l-m,p=c.left+u+v,w="l",o.find(".arrow").css({top:"auto",bottom:"20px"})):(d=c.top-m-v,p=c.left,w="b"):m>h&&b>=f?(d=c.top+l-m,p=c.left-f-v,w="r",o.find(".arrow").css({top:"auto",bottom:"20px"})):(d=c.top-m-v,p=c.left+u-f,w="b",o.find(".arrow").css({left:"auto",right:"20px"})):g>=b?m>_&&g>=f?(d=c.top,p=c.left+u+v,w="l"):(d=c.top+l+v,p=c.left,w="t"):m>_&&b>=f?(d=c.top,p=c.left-f-v,w="r"):(d=c.top+l+v,p=c.left+u-f,w="t",o.find(".arrow").css({left:"auto",right:"20px"})),y=!0),o.find(".arrow").removeClass().addClass("arrow arrow_"+w),y&&n.css({top:d,left:p})},c=function(){var r,c,l;switch(t=e('<div class="dl_card_loading"><div>正在加载，请稍后</div></div>'),"undefined"!=typeof o?o.html(""):(e("body").append('<div class="dl_card"></div>'),o=e(".dl_card")),o.html('<div class="dl_card_layer clearfix"><div class="dl_card_content clearfix"></div><div class="arrow"></div></div>'),o.find(".dl_card_content").append(t),a=i.opts,r=a.content?"html":"ajax"){case"html":o.find(".dl_card_content").html(a.content);break;case"ajax":c=e(n).attr("ajax-href"),l=e(n).attr("ajax-data");var u=e.ajax({url:c,data:l||{},error:function(e){e.status>0&&window.console.log("ajax error")},success:function(t,r,i){var a="object"==typeof i?i:u;200==a.status&&(o.find(".pinwheel_content").html(t),s(e(n),o))}})}},l=function(){for(var e=0;e<r.length;e++)r[e]&&clearInterval(r[e]);r=[]};e.fn.dl_card=function(t){var a=t;return this.each(function(){i={obj:this,opts:a},l(),n&&n==this?(s(e(this),o),o.show()):(n=this,c(),s(e(this),o),o.show(),o.unbind().bind("mouseover",function(e){e.stopPropagation(),l()}),e(this).bind("mouseleave",function(){if(l(),o.is(":visible")){var e=setInterval(function(){o.hide(),l()},50);r.push(e)}}),o.bind("mouseleave",function(){if(l(),o.is(":visible")){var e=setInterval(function(){o.hide(),l()},50);r.push(e)}}))})}}(jQuery);
//# sourceMappingURL=donlerall.min.js.map