"use strict";angular.module("donler.components.campaignCard",[]).controller("CampaignCardCtrl",["$scope","Campaign",function(e,t){this.join=function(e,n,o){t.join({campaignId:o.id,cid:e,tid:n},function(e){e?alertify.alert("参加失败"):(alertify.alert("参加成功"),o.isJoin=!0)})},this.quit=function(e){alertify.confirm("确定要退出该活动吗？",function(n){n&&t.quit(e.id,function(t){t?alertify.alert("退出失败"):(alertify.alert("退出成功"),e.isJoin=!1)})})}}]).directive("campaignCard",function(){return{restrict:"E",replace:!0,scope:{item:"=",role:"@",cid:"@",tid:"@"},templateUrl:"/component_templates/campaign_card.html",controller:"CampaignCardCtrl",link:function(e,t,n,o){e.join=function(t,n){o.join(t,n,e.item)},e.quit=function(){o.quit(e.item)}}}}),angular.module("donler.components",["donler.components.richComment","donler.components.scoreBoard","donler.components.imageBox","donler.components.campaignCard","donler.components.report"]),angular.module("donler.components.imageBox",[]).controller("ImageBoxCtrl",["$scope","$http",function(e,t){e.thumbBoxInnerStyle={},this.maxScrollWidth=0,this.maxShowThumbCount=0,this.thumbWidth=60;var n=this;e.canPrev=!1,e.canNext=!1,e.imagesLoaded=!1,e.setMargin=function(t){var o=0;e.images.length>n.maxShowThumbCount&&(o=t-parseInt((n.maxShowThumbCount-1)/2)),0>o&&(o=0);var r=n.thumbWidth*o;if(n.maxScrollWidth>0){r>n.maxScrollWidth&&(r=n.maxScrollWidth);var i=0-r+"px";e.thumbBoxInnerStyle={"margin-left":i}}e.canPrev=0===r?!1:!0,e.canNext=r>=n.maxScrollWidth?!1:!0},e.getMoreImages=function(n){return e.imagesLoaded?void n():void t({method:"get",url:"/photoAlbum/"+e.photoAlbumId+"/photolist"}).success(function(t){1===t.result&&(e.images=t.data,e.imagesLoaded=!0,n())}).error(function(){console.log("DATA ERROR")})}}]).directive("imageBox",function(){return{restrict:"E",replace:!0,scope:{images:"="},templateUrl:"/component_templates/image_box.html",controller:"ImageBoxCtrl",link:function(e,t,n,o){var r=e.images;if(r.length>0){e.isPreview=!1,e.prevIndex=0,e.thisIndex=0,e.nextIndex=0;var i=0,a=function(t){0>=t?(e.prevIndex=0,e.nextIndex=Math.min(t+1,r.length-1),e.thisIndex=0):t>=r.length-1?(e.prevIndex=Math.max(t-1,0),e.nextIndex=r.length-1,e.thisIndex=r.length-1):(e.prevIndex=t-1,e.nextIndex=t+1,e.thisIndex=t),i=e.thisIndex,e.previewImg=r[e.thisIndex].uri,e.setMargin(e.thisIndex)};e.choose=function(e){a(e)},e.preview=function(t){a(t),e.isPreview=!0},e.prev=function(){a(e.thisIndex-1)},e.next=function(){a(e.thisIndex+1)},e.close=function(){e.isPreview=!1},e.prevList=function(){e.canPrev&&(i-=o.maxShowThumbCount,e.setMargin(i))},e.nextList=function(){e.canNext&&(i+=o.maxShowThumbCount,e.setMargin(i))}}}}}).directive("preImageBox",["$timeout",function(e){return{restrict:"E",replace:!0,scope:{images:"=",photoAlbumId:"="},templateUrl:"/component_templates/preimage_box.html",controller:"ImageBoxCtrl",link:function(t,n,o,r){if(t.images.length>0){t.preImages=t.images,t.isPreview=!1,t.prevIndex=0,t.thisIndex=0,t.nextIndex=0;var i=0,a=function(e){0>=e?(t.prevIndex=0,t.nextIndex=Math.min(e+1,t.images.length-1),t.thisIndex=0):e>=t.images.length-1?(t.prevIndex=Math.max(e-1,0),t.nextIndex=t.images.length-1,t.thisIndex=t.images.length-1):(t.prevIndex=e-1,t.nextIndex=e+1,t.thisIndex=e),i=t.thisIndex,t.previewImg=t.images[t.thisIndex].uri,t.setMargin(t.thisIndex)};t.choose=function(e){a(e)},t.preview=function(n){t.getMoreImages(function(){for(var o=0;o<t.images.length;o++)if(t.images[o].uri==n){e(function(){a(o)});break}}),t.isPreview=!0},t.prev=function(){a(t.thisIndex-1)},t.next=function(){a(t.thisIndex+1)},t.close=function(){t.isPreview=!1},t.prevList=function(){t.canPrev&&(i-=r.maxShowThumbCount,t.setMargin(i))},t.nextList=function(){t.canNext&&(i+=r.maxShowThumbCount,t.setMargin(i))}}}}}]).directive("calWidth",function(){return{require:["^?imageBox","^?preImageBox"],restrict:"A",link:function(e,t,n,o){var r=t.width();o=o[0]||o[1],e.$watch("images",function(t){if(t){var n=o.thumbWidth*e.images.length-r;if(n>0){var i=parseInt(n/o.thumbWidth),a=n%o.thumbWidth;0!=a&&(n=o.thumbWidth*(i+1))}o.maxScrollWidth=n,o.maxShowThumbCount=parseInt(r/o.thumbWidth)}})}}}).directive("needScroll",function(){return{restrict:"A",link:function(e,t){var n=0;e.$watch("previewImg",function(e){if(e){var o=new Image;o.src=e,o.onload=function(){(this.height>document.body.clientHeight||n>document.body.clientHeight)&&window.scrollTo(0,t[0].offsetTop),n=this.height}}})}}}),angular.module("donler.components.report",[]).controller("ReportCtrl",["$scope","Report",function(e,t){this.pushReport=function(){t.publish(e.reportContent,function(e,t){alertify.alert(t)})},this.getReport=function(t,n,o){var r;r="user"==t?{poster:{nickname:o.name,_id:n,cid:o.cid},_id:n}:{poster:o.poster,content:o.content},e.reportContent={hostType:t,hostId:n,hostContent:r,reportType:""},angular.element("#report_modal").modal("show")}}]).directive("reportButton",function(){return{restrict:"E",replace:!0,scope:{hostType:"@",hostId:"@",hostContent:"="},template:'<a ng-click="getReport(hostType,hostId,hostContent)"> 举报</a>',require:"^reportContain",link:function(e,t,n,o){e.getReport=function(e,t,n){o.getReport(e,t,n)}}}}).directive("reportModal",function(){var e=!0;return{restrict:"E",replace:!0,scope:!0,templateUrl:"/component_templates/report_modal.html",require:"^reportContain",link:function(t,n,o,r){t.pushReport=function(){r.pushReport()},t.reportModalLoad=e,e&&(e=!1)}}}).directive("reportContain",function(){return{restrict:"A",controller:"ReportCtrl",link:function(){}}}),angular.module("donler.components.richComment",["angularFileUpload"]).controller("RichCommentCtrl",["$scope","$http","$element","$timeout","Comment","Report","FileUploader",function(e,t,n,o,r,i,a){e.pages=[],e.nowPage=0,e.showMoreComment=!1;var c=function(t){Object.defineProperty(this,"photo_album_id",{set:function(e){this.uploader.url="/photoAlbum/"+e+"/photo/single"}}),t&&(this.host_type=t.host_type,this.host_id=t.host_id,this.photo_album_id=t.photo_album_id);var n=new a({url:this.photo_album_id?"/photoAlbum/"+this.photo_album_id+"/photo/single":null});n.filters.push({name:"imageFilter",fn:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}}),n.onAfterAddingAll=function(){e.afterRender&&o(function(){e.afterRender()})},this.uploader=n};c.prototype.publish=function(t,n){if(t||""!==t){var i=this;if(i.uploader.getNotUploadedItems().length>0){if(!this.uploader.url||""===this.uploader.url)return;i.uploader.uploadAll(),i.uploader.onSuccessItem=function(){e.afterRender&&o(function(){e.afterRender()})},i.uploader.onCompleteAll=function(){r.publish({host_id:i.host_id,host_type:i.host_type,content:t},function(e,t){i.uploader.clearQueue(),n(e,t)})}}else r.publish({host_id:i.host_id,host_type:i.host_type,content:t},function(e,t){i.uploader.clearQueue(),n(e,t)})}};var s=new c;e.uploader=s.uploader,e.publish=function(t,n){s.publish(t,function(t,r){t?console.log(t):(e.comments.unshift({_id:r._id,host_id:r.host_id,content:r.content,create_date:r.create_date,poster:r.poster,photos:r.photos,host_type:r.host_type,delete_permission:!0}),e.new_comment.text="",n.$setPristine(),e.afterRender&&o(function(){e.afterRender()}))})},e.componentId&&t.get("/components/RichComment/id/"+e.componentId).success(function(t){1===t.result&&(s.host_type=t.componentData.hostType,s.host_id=t.componentData.hostId,s.photo_album_id=t.componentData.photoAlbumId,e.photoAlbumId=t.componentData.photoAlbumId,e.userPhoto=t.componentData.userPhoto,r.get("campaign",s.host_id,function(t,n,r){if(t)alertify.alert("获取评论失败，请刷新页面重试");else{if(e.comments=n,!e.pages[e.nowPage]){var i={nextStartDate:r};e.comments[0]&&(i.thisStartDate=e.comments[0].create_date),e.pages.push(i)}e.afterRender&&o(function(){e.afterRender()})}}))}).error(function(){alertify.alert("获取评论失败，请刷新页面重试")}),e.new_comment={text:""};var u=function(e){r.getReplies(e._id,function(t,n){e.replies=n,e.reply_count=n.length})};e.last_reply_comment,e.toggleComment=function(t){e.last_reply_comment&&e.last_reply_comment!=t&&(e.last_reply_comment.replying=!1),t.replying=!t.replying,e.last_reply_comment=t,t.replying&&(u(t),e.now_reply_to={_id:t.poster._id,nickname:t.poster.nickname},e.afterRender&&o(function(){e.afterRender()}))},e.setReplyTo=function(t,n,o){e.last_reply_comment!=t&&(e.last_reply_comment.replying=!1,e.last_reply_comment=t),t.replying||(t.replying=!0),e.now_reply_to={_id:n,nickname:o}},e.reply=function(t,n){t.new_reply&&""!==t.new_reply&&r.reply(t._id,e.now_reply_to._id,t.new_reply,function(r,i){r||(t.replies||(t.replies=[]),t.replies.push(i),t.reply_count++,t.new_reply="",n.$setPristine(),e.afterRender&&o(function(){e.afterRender()}))})},e.deleteComment=function(t){alertify.confirm("确认要删除该评论吗？",function(n){if(n)try{r.remove(e.comments[t]._id,function(n){n?alertify.alert("删除失败，请重试。"):(e.comments.splice(t,1),e.afterRender&&o(function(){e.afterRender()}))})}catch(n){console.log(n)}})},e.removeReply=function(t,n){alertify.confirm("确认要删除该回复吗？",function(i){if(i){var a=t.replies[n];r.remove(a._id,function(r){r?alertify.alert("删除失败，请重试。"):(t.replies.splice(n,1),t.reply_count--,e.afterRender&&o(function(){e.afterRender()}))})}})},e.nextPage=function(){r.get("campaign",s.host_id,function(t,n,o){if(t)alertify.alert("获取评论失败，请刷新页面重试");else if(e.comments=n,e.nowPage++,!e.pages[e.nowPage]){var r={thisStartDate:e.pages[e.nowPage-1].nextStartDate,nextStartDate:o};e.pages.push(r)}},e.pages[e.nowPage].nextStartDate)},e.lastPage=function(){r.get("campaign",s.host_id,function(t,n){t?alertify.alert("获取评论失败，请刷新页面重试"):(e.comments=n,e.nowPage--)},e.pages[e.nowPage-1].thisStartDate)},e.changePage=function(t){r.get("campaign",s.host_id,function(n,o){n?alertify.alert("获取评论失败，请刷新页面重试"):(e.comments=o,e.nowPage=t)},e.pages[t].thisStartDate)},e.showMore=function(){e.showMoreComment=!0,e.afterRender&&o(function(){e.afterRender()})},e.originPlaceholder="输入内容请控制在140字以内",e.currentPlaceholder={comment:e.originPlaceholder,reply:e.originPlaceholder}}]).directive("simpleComment",function(){return{restrict:"E",replace:!0,controller:"RichCommentCtrl",scope:{componentId:"@",photoAlbumId:"@",allowPublish:"@",commentNum:"@",afterRender:"&"},templateUrl:"/component_templates/simple_comment.html"}}).directive("richComment",function(){return{restrict:"E",replace:!0,controller:"RichCommentCtrl",scope:{componentId:"@",photoAlbumId:"@",allowPublish:"@"},templateUrl:"/component_templates/rich_comment.html"}}).directive("toggleFocus",function(){return{restrict:"A",scope:{toggleFocus:"="},link:function(e,t){e.$watch("toggleFocus",function(e){e===!0&&t.focus()})}}}),angular.module("donler.components.scoreBoard",[]).controller("ScoreBoardCtrl",["$scope","ScoreBoard",function(e,t){e.leaderStatus="init",e.allowEdit=!1,e.allowManage=!1;var n=function(){t.getData(e.componentId,function(t,n){if(t)alertify.alert(t);else if(e.scoreBoard=n,e.scoreBoard.effective){e.scores=[],e.results=[];for(var o=0;o<e.scoreBoard.playingTeams.length;o++){var r=e.scoreBoard.playingTeams[o];e.scores.push(r.score),e.results.push(r.result),1===e.scoreBoard.status?r.allowManage&&(e.allowEdit=!0,e.leaderStatus=r.confirm?"waitConfirm":"toConfirm"):0===e.scoreBoard.status&&r.allowManage&&(e.allowEdit=!0),r.allowManage&&(e.allowManage=!0)}}})};n(),e.editing=!1,e.setResult=function(t,n){0===n?(e.results[0]=t,e.results[1]=0-t):1===n&&(e.results[0]=0-t,e.results[1]=t)},e.toggleEdit=function(){e.editing=!e.editing};var o=function(){e.editing=!1,1===e.scoreBoard.status,e.leaderStatus="waitConfirm";for(var t=0;t<e.scoreBoard.playingTeams.length;t++){var n=e.scoreBoard.playingTeams[t];n.score=e.scores[t],n.result=e.results[t]}};e.initScore=function(){t.initScore(e.componentId,{scores:e.scores,results:e.results},function(e){e?alertify.alert(e):o()})},e.resetScore=function(){t.resetScore(e.componentId,{scores:e.scores,results:e.results},function(e){e?alertify.alert(e):o()})},e.confirmScore=function(){var n="提示：同意后将无法修改，确定要同意吗？";alertify.confirm(n,function(n){n&&t.confirmScore(e.componentId,function(t){t?alertify.alert(t):(e.scoreBoard.allConfirm=!0,e.leaderStatus="confirm",e.scoreBoard.status=2)})})},e.showLogs=!1,e.toggleLogs=function(){e.showLogs?e.showLogs=!1:t.getLogs(e.componentId,function(t,n){t?alertify.alert(t):(e.logs=n,e.showLogs=!0)})}}]).factory("ScoreBoard",["$http",function(e){var t=function(t,n,o,r){e.post("/components/ScoreBoard/id/"+t+"/setScore",{data:n,isInit:o}).success(function(e){1===e.result?r():r(e.msg)}).error(function(){r("设置失败")})};return{getData:function(t,n){e.get("/components/ScoreBoard/id/"+t).success(function(e){1===e.result?n(null,e.componentData):n("获取比分失败，请刷新页面重试")}).error(function(){n("获取比分失败，请刷新页面重试")})},initScore:function(e,n,o){t(e,n,!0,o)},resetScore:function(e,n,o){t(e,n,!1,o)},confirmScore:function(t,n){e.post("/components/ScoreBoard/id/"+t+"/confirmScore").success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("操作失败，请重试。")})},getLogs:function(t,n){e.get("/components/ScoreBoard/id/"+t+"/getLogs").success(function(e){1===e.result?n(null,e.logs):n(e.msg)}).error(function(){n("获取记录失败，请重试。")})}}}]).directive("scoreBoard",function(){return{restrict:"E",replace:!0,controller:"ScoreBoardCtrl",templateUrl:"/component_templates/score_board.html",scope:{componentId:"@"}}}),angular.module("donler",["ngRoute","ui.bootstrap","pascalprecht.translate","wu.masonry","angular-carousel","donler.components"]);var app=angular.module("donler");app.directive("match",["$parse",function(e){return{require:"ngModel",link:function(t,n,o,r){t.$watch(function(){return e(o.match)(t)===r.$modelValue},function(e){r.$setValidity("mismatch",e)})}}}]),app.directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){e.$watch("member_max",function(){void 0!=e.member_min&&o.$setViewValue(o.$viewValue)});var r=function(t){var r=e.$eval(n.ngMin)||0;return r>t?(o.$setValidity("ngMin",!1),t):(o.$setValidity("ngMin",!0),t)};o.$parsers.push(r),o.$formatters.push(r)}}}),app.directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){e.$watch("member_min",function(){void 0!=e.member_max&&o.$setViewValue(o.$viewValue)});var r=function(t){var r=e.$eval(n.ngMax)||1/0;return t>r?(o.$setValidity("ngMax",!1),t):(o.$setValidity("ngMax",!0),t)};o.$parsers.push(r),o.$formatters.push(r)}}}),app.directive("bsPopover",function(){return{controller:["$http","$scope",function(e,t){t.showUserCard=function(n,o){t.member_id===n?$("#pop"+o).dl_card({content:t.htmlcontent}):(t.member_id=n,e.get("/users/briefInfo/"+n).success(function(e){t.htmlcontent=e,$("#pop"+o).dl_card({content:e})}))},t.showGroupCard=function(n,o){t.group_id===n?$("#pop"+o).dl_card({content:t.htmlcontent}):(t.group_id=n,e.get("/group/briefInfo/"+n).success(function(e){$("#pop"+o).dl_card({content:e}),t.htmlcontent=e}))}}]}}),app.directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){var r;if(o){o.$render=function(){return t.html(o.$viewValue)};var i=function(){var i=$.trim(t.html());return o.$viewValue!==i?(i.replace(/<\/?[^>]*>/g,"").replace(/[\u4e00-\u9fa5]/g,"**").length>n.mixMaxlength?o.$setValidity("mixlength",!1):o.$setValidity("mixlength",!0),e.$apply(r)):void 0},a=function(e){var t=e.currentTarget.innerHTML;setTimeout(function(){for(var n=e.currentTarget.innerHTML,o=-1,r=-1,a=0;a<n.length;a++)-1==o&&t.substr(a,1)!=n.substr(a,1)&&(o=a),-1==r&&t.substr(t.length-a-1,1)!=n.substr(n.length-a-1,1)&&(r=a);var c=n.substr(o,n.length-r-o),s=c.replace(/style\s*=(['\"\s]?)[^'\"]*?\1/gi,"").replace(/class\s*=(['\"\s]?)[^'\"]*?\1/gi,""),u=n.substr(0,o)+s+n.substr(o+c.length);e.currentTarget.innerHTML=u,i(e)},100)};return t.bind("focus",function(){t.bind("input",i),t.bind("keydown",i),t.bind("paste",a)}),t.bind("blur",function(e){t.unbind("input",i),t.unbind("keydown",i),t.unbind("paste",a),i(e)}),r=function(){return o.$setViewValue($.trim(t.html()))}}}}}),app.directive("mixMaxlength",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){var r=parseInt(n.mixMaxlength)||10;e.$watch(n.ngModel,function(e){e&&e.replace(/[\u4e00-\u9fa5]/g,"**").length>r?o.$setValidity("mixlength",!1):o.$setValidity("mixlength",!0)})}}}),app.directive("bootstrapTagsinput",[function(){function e(e,t){return t?angular.isFunction(e.$parent[t])?e.$parent[t]:function(e){return e[t]}:void 0}return{restrict:"EA",scope:{model:"=ngModel"},template:"<select multiple></select>",replace:!1,link:function(t,n,o){$(function(){angular.isArray(t.model)||(t.model=[]);var r=$("select",n),i=o.typeaheadSource?o.typeaheadSource.split("."):null,a=i?i.length>1?t.$parent[i[0]][i[1]]:t.$parent[i[0]]:null;r.tagsinput(t.$parent[o.options||""]||{typeahead:{source:angular.isFunction(a)?a:null},itemValue:e(t,o.itemvalue),itemText:e(t,o.itemtext),confirmKeys:e(t,o.confirmkeys)?JSON.parse(o.confirmkeys):[13],tagClass:angular.isFunction(t.$parent[o.tagclass])?t.$parent[o.tagclass]:function(){return o.tagclass}});for(var c=0;c<t.model.length;c++)r.tagsinput("add",t.model[c]);r.on("itemAdded",function(e){-1===t.model.indexOf(e.item)&&t.model.push(e.item)}),r.on("itemRemoved",function(e){var n=t.model.indexOf(e.item);-1!==n&&t.model.splice(n,1)});var s=t.model.slice();t.$watch("model",function(){var e,n=t.model.filter(function(e){return-1===s.indexOf(e)}),o=s.filter(function(e){return-1===t.model.indexOf(e)});for(s=t.model.slice(),e=0;e<o.length;e++)r.tagsinput("remove",o[e]);for(r.tagsinput("refresh"),e=0;e<n.length;e++)r.tagsinput("add",n[e])},!0)})}}}]),app.directive("ngThumb",["$window",function(e){var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}};return{restrict:"A",template:"<canvas/>",link:function(e,n,o){function r(e){var t=new Image;t.onload=i,t.src=e.target.result}function i(){var e=a.width||this.width/this.height*a.height,t=a.height||this.height/this.width*a.width;c.attr({width:e,height:t}),c[0].getContext("2d").drawImage(this,0,0,e,t)}if(t.support){var a=e.$eval(o.ngThumb);if(t.isFile(a.file)&&t.isImage(a.file)){var c=n.find("canvas"),s=new FileReader;s.onload=r,s.readAsDataURL(a.file)}}}}}]),app.run(["$rootScope",function(e){alertify.set({buttonFocus:"none",labels:{ok:"确认",cancel:"取消"}}),e.shortTrim=function(e){return escape(e).indexOf("%u")>=0?e.length>6?e.substr(0,6)+"...":e:e.length>15?e.substr(0,15)+"...":e}}]),app.filter("dateView",function(){return function(e){var t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0);var n=new Date(e),o=n.getTime()-t.getTime(),r=Math.floor(o/864e5),i=(n.getHours()<10?"0"+n.getHours():n.getHours())+":"+(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes());switch(r){case-2:return"前天"+i;case-1:return"昨天"+i;case 0:return"今天"+i;case 1:return"明天"+i;case 2:return"后天"+i;default:return e}}}),app.filter("day",function(){return function(e){var t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0);var n=new Date(e),o=n.getTime()-t.getTime(),r=Math.floor(o/864e5);switch(r){case-1:return"昨天";case 0:return"今天";case 1:return"明天";default:return n.getMonth()+1+"-"+n.getDate()}}}),app.filter("week",function(){return function(e){switch(new Date(e).getDay()){case 0:e="周日";break;case 1:e="周一";break;case 2:e="周二";break;case 3:e="周三";break;case 4:e="周四";break;case 5:e="周五";break;case 6:e="周六";break;default:e=""}return e}}),angular.module("donler").factory("Campaign",["$http",function(e){var t=function(t,n,o){try{e({method:"post",url:t,data:n}).success(function(e){1===e.result?o(null,e):o("活动发布出错 "+e.msg)}).error(function(){o("error")})}catch(r){console.log(r)}},n=function(t,n,o){e.get("/"+t+"/getTags/"+n).success(function(e){o(null,e)}).error(function(){o("error")})},o=function(t,n,o){e.get("/campaign/getMolds/"+t+"/"+n).success(function(e){0===e.result?o(e.msg):o(null,e)}).error(function(){o("error")})},r=function(t,n){e.post("/campaign/joinCampaign/"+t.campaignId,{cid:t.cid,tid:t.tid}).success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("参加失败，请重试。")})},i=function(t,n){e.post("/campaign/quitCampaign/"+t).success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("退出失败，请重试。")})},a=function(t,n,o){e.post("/campaign/edit/"+t,n).success(function(e){1===e.result?o():o(e.msg)}).error(function(){o("编辑失败，请重试。")})},c=function(t,n){e.post("/campaign/cancel/"+t).success(function(e){1===e.result?n():n(e.msg)}).error(function(){n("关闭活动失败，请重试。")})},s=function(t,n,o,r){e({method:"post",url:"/campaign/dealProvoke/"+t,data:{tid:n,responseStatus:o}}).success(function(e){1===e.result?r():r(e.msg)}).error(function(){r("DATA ERROR")})},u=function(t,n){if(t)var o="/group/getLedTeams/"+t;else var o="/group/getLedTeams";e.get(o).success(function(e){0===e.result?n(e.msg):n(null,e)})},l=function(t,n,o,r){var i="";o&&o.year&&o.month&&(i="?year="+o.year+"&month="+o.month),e.get("/campaign/getCampaignData/"+t+"/"+n+i).success(function(e){1===e.result?r(null,e.timeLine):r(e.msg)}).error(function(){r("error")})},f=function(t,n,o){e.get("/campaign/getDateRecord/"+t+"/"+n).success(function(e){1===e.result?o(null,e.dateRecord):o(e.msg)}).error(function(){o("error")})},p=function(t,n){e.get("/campaign/"+t+"/pageData").success(function(e){1===e.result?n(null,{campaign:e.campaign,allow:e.allow}):n("error")}).error(function(){n("error")})},m=function(t,n){e.get("/campaign/"+t+"/members").success(function(e){1===e.result?n(null,e.units,e.memberCount):n("error")}).error(function(){n("error")})},d=function(t,n){e.get("/campaign/"+t+"/notices").success(function(e){1===e.result?n(null,e.notices):n("error")}).error(function(){n("error")})};return{sponsor:t,getTags:n,join:r,quit:i,edit:a,cancel:c,getMolds:o,dealProvoke:s,getLedTeams:u,getCampaignsData:l,getCampaignsDateRecord:f,getDetailPageData:p,getMembers:m,getNotices:d}}]),angular.module("donler").factory("Comment",["$http",function(e){var t=function(t,n,o,r,i){e.post("/comment/pull/"+t+"/"+n,{create_date:r,num:i}).success(function(e){o(null,e.comments,e.nextStartDate)}).error(function(){o("error")})},n=function(t,n){e.post("/comment/push/"+t.host_type+"/"+t.host_id,t).success(function(e){"SUCCESS"===e.msg?n(null,e.comment):n("error")}).error(function(){n("error")})},o=function(t,n){e.delete("/comment/"+t).success(function(e){1===e.result?n():n("error")}).error(function(){n("error")})},r=function(t,n,o,r){e.post("/comment/"+t+"/reply",{to:n,content:o}).success(function(e){1===e.result?r(null,e.reply):r("error")}).error(function(){r("error")})},i=function(t,n){e.get("/comment/"+t+"/replies").success(function(e){1===e.result?n(null,e.replies):n("error")}).error(function(){n("error")})};return{get:t,publish:n,reply:r,remove:o,getReplies:i}}]),angular.module("donler").factory("PhotoAlbum",["$http",function(e){var t=function(e){this.id=e};return t.prototype.getInfo=function(t){e.get("/photoAlbum/"+this.id).success(function(e){1===e.result?t(null,e.data):t(e.msg)}).error(function(){t("error")})},t.prototype.getPhotos=function(t){e.get("/photoAlbum/"+this.id+"/photolist").success(function(e){1===e.result?t(null,e.data):t(e.msg,[])}).error(function(){t("error",[])})},t.prototype.changeName=function(t){var n=this;return function(o){e.put("/photoAlbum/"+n.id,{name:o}).success(function(e){1===e.result?t(null,e.data):t(e.msg)}).error(function(){t("error")})}},t.prototype.delete=function(t){e.delete("/photoAlbum/"+this.id).success(function(e){1===e.result?t():t(e.msg)}).error(function(){t("error")})},t}]),angular.module("donler").factory("Report",["$http",function(e){var t=function(t,n){e.post("/report/push/",t).success(function(e){1===e.result?n(null,e.msg):n("error",e.msg)}).error(function(){n("error","数据发送错误")})};return{publish:t}}]),angular.module("donler").factory("Search",["$http",function(e){var t=function(t,n,o){try{e.get("/search/sameCityTeam/"+t+"?page="+n).success(function(e){o(null,e)}).error(function(){o("error")})}catch(r){console.log(r),o("error")}},n=function(t,n,o,r){try{e.get("/search/nearbyTeam/"+t+"?page="+n+"&index="+o).success(function(e){r(null,e)}).error(function(){r("error")})}catch(i){console.log(i),r("error")}},o=function(t,n){e.get("/group/opponentInfo/"+t).success(function(e){n(null,e)}).error(function(){n("error")})},r=function(t,n,o,r){e.get("/search/keywordSearch/"+t+"?key="+n+"&page="+o).success(function(e){r(null,e)}).error(function(){r("error")})};return{searchSameCity:t,getOpponentInfo:o,searchNearby:n,searchTeam:r}}]),angular.module("donler").service("anchorSmoothScroll",function(){this.scrollTo=function(e){function t(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function n(e){var t=document.getElementById(e);if(!t)return 0;for(var n=t.offsetTop,o=t;o.offsetParent&&o.offsetParent!=document.body;)o=o.offsetParent,n+=o.offsetTop;return n}var o,r,i,a=20;if(o=t(),r=n("number"==typeof e?e:e),i=r>o?r-o:o-r,100>i)return window.scrollByU=!0,void scrollTo(0,r);var c=Math.round(i/200);c>=a&&(c=a);var s=Math.round(i/25),u=r>o?o+s:o-s,l=0;if(r>o)for(var f=o;r>f;f+=s)setTimeout("window.scrollByU =true;window.scrollTo(0, "+u+")",l*c),u+=s,u>r&&(u=r),l++;else for(var f=o;f>r;f-=s)setTimeout("window.scrollByU =true;window.scrollTo(0, "+u+")",l*c),u-=s,r>u&&(u=r),l++}});var donler=angular.module("donler");donler.factory("Team",["$http",function(e){return{getTeamInfo:function(t,n){e.get("/group/"+t+"/info").success(function(e){1===e.result?n(null,{team:e.team,allow:e.allow,isShowHomeCourts:e.isShowHomeCourts,role:e.role}):n("error")}).error(function(){n("error")})},getTeamMembers:function(t,n){e.get("/group/"+t+"/members").success(function(e){1===e.result?n(null,e.members):n("error")}).error(function(){n("error")})},join:function(t,n){e.post("/users/joinGroup",{tid:t}).success(function(e){1===e.result?n():n("error")}).error(function(){n("error")})},quit:function(t,n){e.post("/users/quitGroup",{tid:t}).success(function(e){1===e.result?n():n("error")}).error(function(){n("error")})},saveInfo:function(t,n,o){var r;if(n.homecourt){r=n.homecourt;for(var i=0;i<r.length;i++)r[i].name||r.splice(i,1)}e.post("/group/saveInfo/"+t,{name:n.name,brief:n.brief,homecourt:r}).success(function(e){1===e.result?o():o(e.msg)}).error(function(){o("error")})}}}]);var messageApp=angular.module("donler");messageApp.run(["$http","$rootScope",function(e,t){t.o=0}]),messageApp.controller("messageHeaderController",["$scope","$http","$rootScope",function(e,t,n){"/message/home"!=location.pathname&&t.get("/message/header").success(function(e){var t=e.msg;n.o=t.length})}]),function(e){var t,n,o,r=[],i=[],a={},c=function(t,o){var r,i,a,c,s,u,l,f,p,m,d,g,h,v,y,w,x=5,b=!1;r=e(document).scrollTop(),i=e(document).scrollLeft(),a=e(window).height(),c=e(window).width(),s=t.offset(),u=t.outerHeight(),l=t.outerWidth(),m=o.outerHeight(),d=o.outerWidth(),s.top-r-m-x>=0&&(c+i-s.left-d>=0?(f=s.top-m-x,p=s.left,b=!0,w="b"):s.left+l-i-d>=0&&(f=s.top-m-x,p=s.left+l-d,b=!0,w="b",n.find(".arrow").css({left:"auto",right:"20px"}))),b||a-(s.top+u-r)-m-x>=0&&(c+i-s.left-d>=0?(f=s.top+u+x,p=s.left,b=!0,w="t"):s.left+l-i-d>=0&&(f=s.top+u+x,p=s.left+l-d,b=!0,w="t",n.find(".arrow").css({left:"auto",right:"20px"}))),b||c+i-s.left-l-d-x>=0&&(s.top+u-r-m>=0?(f=s.top+u-m,p=s.left+l+x,b=!0,w="l",n.find(".arrow").css({top:"auto",bottom:"20px"})):s.top+a-r-m>=0&&(f=s.top,p=s.left+l+x,b=!0,w="l")),b||s.left-i-d-x>=0&&(a-(s.top-r)-m>=0?(f=s.top,p=s.left-d-x,b=!0,w="r"):s.top+u-r-m>=0&&(f=s.top+u-m,p=s.left-d-x,b=!0,w="r",n.find(".arrow").css({top:"auto",bottom:"20px"}))),b||(g=s.top-r+u/2,v=a-g,y=s.left-i+l/2,h=c-y,g>=v?h>=y?m>g&&h>=d?(f=s.top+u-m,p=s.left+l+x,w="l",n.find(".arrow").css({top:"auto",bottom:"20px"})):(f=s.top-m-x,p=s.left,w="b"):m>g&&y>=d?(f=s.top+u-m,p=s.left-d-x,w="r",n.find(".arrow").css({top:"auto",bottom:"20px"})):(f=s.top-m-x,p=s.left+l-d,w="b",n.find(".arrow").css({left:"auto",right:"20px"})):h>=y?m>v&&h>=d?(f=s.top,p=s.left+l+x,w="l"):(f=s.top+u+x,p=s.left,w="t"):m>v&&y>=d?(f=s.top,p=s.left-d-x,w="r"):(f=s.top+u+x,p=s.left+l-d,w="t",n.find(".arrow").css({left:"auto",right:"20px"})),b=!0),n.find(".arrow").removeClass().addClass("arrow arrow_"+w),b&&o.css({top:f,left:p})},s=function(){var r,s,u;switch(t=e('<div class="dl_card_loading"><div>正在加载，请稍后</div></div>'),"undefined"!=typeof n?n.html(""):(e("body").append('<div class="dl_card"></div>'),n=e(".dl_card")),n.html('<div class="dl_card_layer clearfix"><div class="dl_card_content clearfix"></div><div class="arrow"></div></div>'),n.find(".dl_card_content").append(t),a=i.opts,r=a.content?"html":"ajax"){case"html":n.find(".dl_card_content").html(a.content);break;case"ajax":s=e(o).attr("ajax-href"),u=e(o).attr("ajax-data");var l=e.ajax({url:s,data:u||{},error:function(e){e.status>0&&window.console.log("ajax error")},success:function(t,r,i){var a="object"==typeof i?i:l;200==a.status&&(n.find(".pinwheel_content").html(t),c(e(o),n))}})}},u=function(){for(var e=0;e<r.length;e++)r[e]&&clearInterval(r[e]);r=[]};e.fn.dl_card=function(t){var a=t;return this.each(function(){i={obj:this,opts:a},u(),o&&o==this?(c(e(this),n),n.show()):(o=this,s(),c(e(this),n),n.show(),n.unbind().bind("mouseover",function(e){e.stopPropagation(),u()}),e(this).bind("mouseleave",function(){if(u(),n.is(":visible")){var e=setInterval(function(){n.hide(),u()},50);r.push(e)}}),n.bind("mouseleave",function(){if(u(),n.is(":visible")){var e=setInterval(function(){n.hide(),u()},50);r.push(e)}}))})}}(jQuery);
//# sourceMappingURL=donlerall.min.js.map